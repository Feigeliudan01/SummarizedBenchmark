<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SummarizedBenchmark • SummarizedBenchmark</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SummarizedBenchmark">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SummarizedBenchmark</a>
        <span class="label label-info" data-toggle="tooltip" data-placement="bottom" title="Bioc Devel">1.99.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">General</li>
    <li>
      <a href="../articles/SummarizedBenchmark.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/Appendix.html">Appendix</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Case Studies</li>
    <li>
      <a href="../articles/SingleCellBenchmark.html">scRNA-seq Simulation</a>
    </li>
    <li>
      <a href="../articles/QuantificationBenchmark.html">RNA-seq Quantification</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/areyesq89/SummarizedBenchmark">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>SummarizedBenchmark</h1>
                        <h4 class="author">Patrick K. Kimes, Alejandro Reyes</h4>
            
            <h4 class="date">23 October 2018</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/areyesq89/SummarizedBenchmark/blob/master/vignettes/SummarizedBenchmark.Rmd"><code>vignettes/SummarizedBenchmark.Rmd</code></a></small>
      <div class="hidden name"><code>SummarizedBenchmark.Rmd</code></div>

    </div>

    
        <div class="abstract">
      <p class="abstract">Abstract</p>
      “When performing a data analysis in R, users are often presented with multiple packages and methods for accomplishing the same task. Benchmarking the performance of these different methods on real and simulated data sets is a common way of learning the relative strengths and weaknesses of each approach. However, as the number of tools and parameters increases, keeping track of output and how it was generated can quickly becomes messy. The <code>SummarizedBenchmark</code> package provides a framework for organizing benchmark comparisons, making it easier to both reproduce the original benchmark and replicate the comparison with new data. This vignette introduces the general approach and features of the package using two examples. SummarizedBenchmark package version: 1.99.2”
    </div>
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>With <code>SummarizedBenchmark</code>, a complete benchmarking workflow is comprised of three primary components:</p>
<ol style="list-style-type: decimal">
<li>data,</li>
<li>methods, and</li>
<li>performance metrics.</li>
</ol>
<p>The first two (<em>data</em> and <em>methods</em>) are necessary for carrying out the benchmark experiment, and the last (<em>performance metrics</em>) is essential for evaluating the results of the experiment. Following this approach, the <code>SummarizedBenchmark</code> package defines two primary types of objects: <em>BenchDesign</em> objects and <em>SummarizedBenchmark</em> objects. <em>BenchDesign</em> objects contain only the design of the benchmark experiment, namely the <em>data</em> and <em>methods</em>, where a <em>method</em> is defined as the combination of a function or algorithm and parameter settings. After constructing a <em>BenchDesign</em>, the experiment is executed to create a <em>SummarizedBenchmark</em> containing the results of applying the methods to the data. <em>SummarizedBenchmark</em> objects extend the Bioconductor <code>SummarizedExperiment</code> class, with the additional capability of working with <em>performance metrics</em>.</p>
<p>The basic framework is illustrated in the figure below. A <em>BenchDesign</em> is created with <em>methods</em> and combined with <em>data</em> to create a <em>SummarizedBenchmark</em>, which contains the output of applying the methods to the data. This output is then paired with <em>performance metrics</em> specified by the user. Note that the same <em>BenchDesign</em> can be combined with several data sets to produce several <em>SummarizedBenchmark</em> objects with the corresponding outputs. For convenience, several default <em>performance metrics</em> are implemented in the package, and can be added to <em>SummarizedBenchmark</em> objects using simple commands.</p>
<div class="figure">
<img src="summarizedbenchmark-figure1.png" alt="basic benchmarking class relationship"><p class="caption">basic benchmarking class relationship</p>
</div>
<p>In this vignette, we first illustrate the basic use of both the <em>BenchDesign</em> and <em>SummarizedBenchmark</em> classes with a simple comparison of methods for p-value correction in the context of multiple hypothesis testing. Then, we describe more advanced features of the package with a case study comparing three methods for differential expression analysis.</p>
<div id="related-work" class="section level2">
<h2 class="hasAnchor">
<a href="#related-work" class="anchor"></a>Related Work</h2>
<p>Other frameworks for benchmarking methods include <em><a href="http://bioconductor.org/packages/iCOBRA">iCOBRA</a></em> (a package for comparing results of <em>“binary classification and ranking methods”</em> with a Shiny web application for interactive analyses), <em><a href="http://bioconductor.org/packages/rnaseqcomp">rnaseqcomp</a></em> (a package for comparing results of RNA-seq quantification pipelines), and <em><a href="https://github.com/stephenslab/dsc">dsc</a></em> (a framework for <em>“managing computational benchmarking experiments that compare several competing methods”</em> written in Python but capable of running methods implemented in both Python and R).</p>
</div>
</div>
<div id="quickstart-case-study" class="section level1">
<h1 class="hasAnchor">
<a href="#quickstart-case-study" class="anchor"></a>Quickstart Case Study</h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"SummarizedBenchmark"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(<span class="st">"magrittr"</span>)</a></code></pre></div>
<p>To illustrate the basic use of the <em>BenchDesign</em> class, we use the <code>tdat</code> data set included with this package.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">data</span>(tdat)</a></code></pre></div>
<p>The data set is a <em>data.frame</em> containing the results of 50 two-sample t-tests. The tests were performed using independently simulated sets of 20 observations drawn from a single standard Normal distribution (when <code>H = 0</code>) or two mean-shifted Normal distributions (when <code>H = 1</code>).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">head</span>(tdat)</a></code></pre></div>
<pre><code>##   H test_statistic effect_size         pval        SE
## 1 1     -3.2083437 -1.17151466 4.872282e-03 0.3651463
## 2 0      0.1692236  0.07321912 8.675080e-01 0.4326768
## 3 1     -5.7077940 -1.81715381 2.061521e-05 0.3183636
## 4 1     -1.9805856 -1.09107836 6.313031e-02 0.5508867
## 5 1     -1.0014358 -0.37726058 3.298895e-01 0.3767197
## 6 1     -0.9190433 -0.47583669 3.702252e-01 0.5177522</code></pre>
<p>Several approaches have been proposed and implemented to compute <em>adjusted p-values</em> and <em>q-values</em> with the goal of controlling the total number of false discoveries across a collection of tests. In this example, we compare three such methods:</p>
<ol style="list-style-type: decimal">
<li>Bonferroni correction (<code>p.adjust</code> w/ <code>method = "bonferroni"</code>) <span class="citation">(Dunn 1961)</span>,</li>
<li>Benjamini-Hochberg (<code>p.adjust</code> w/ <code>method = "BH"</code>) <span class="citation">(Benjamini and Hochberg 1995)</span>, and</li>
<li>Storey’s FDR q-value (<code><a href="http://www.rdocumentation.org/packages/qvalue/topics/qvalue">qvalue::qvalue</a></code>) <span class="citation">(Storey 2002)</span>.</li>
</ol>
<p>First, consider how benchmarking the three methods might look without the <em>SummarizedBenchmark</em> framework.</p>
<p>To compare methods, each is applied to <code>tdat</code>, and the results are stored in separate variables.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">adj_bonf &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(<span class="dt">p =</span> tdat<span class="op">$</span>pval, <span class="dt">method =</span> <span class="st">"bonferroni"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">adj_bh &lt;-<span class="st"> </span><span class="kw">p.adjust</span>(<span class="dt">p =</span> tdat<span class="op">$</span>pval, <span class="dt">method =</span> <span class="st">"BH"</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">qv &lt;-<span class="st"> </span>qvalue<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/qvalue/topics/qvalue">qvalue</a></span>(<span class="dt">p =</span> tdat<span class="op">$</span>pval)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">adj_qv &lt;-<span class="st"> </span>qv<span class="op">$</span>qvalues</a></code></pre></div>
<p>Since the values of interest are available from the ouput of each method as a vector of length 50 (the number of hypotheses tested), to keep things clean, they can be combined into a single <em>data.frame</em>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">adj &lt;-<span class="st"> </span><span class="kw">cbind.data.frame</span>(adj_bonf, adj_bh, adj_qv)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw">head</span>(adj)</a></code></pre></div>
<pre><code>##     adj_bonf     adj_bh       adj_qv
## 1 0.24361409 0.02191765 0.0079813228
## 2 1.00000000 0.90365415 0.3290660527
## 3 0.00103076 0.00103076 0.0003753518
## 4 1.00000000 0.12140444 0.0442094809
## 5 1.00000000 0.47127065 0.1716134119
## 6 1.00000000 0.48250104 0.1757029652</code></pre>
<p>The <em>data.frame</em> of adjusted p-values and q-values can be used to compare the methods, either by directly parsing the table or using a framework like <em><a href="http://bioconductor.org/packages/iCOBRA">iCOBRA</a></em>. Additionally, the <em>data.frame</em> can be saved as a <code>RDS</code> or <code>Rdata</code> object for future reference, eliminating the need for recomputing on the original data.</p>
<p>While this approach can work well for smaller comparisons, it can quickly become overwhelming and unweildy as the number of methods and parameters increases. Furthermore, once each method is applied and the final <em>data.frame</em> (<code>adj</code>) is constructed, there is no way to determine <em>how</em> each value was calculated. While an informative name can be used to “label” each method (as done above), this does not capture the full complexity, e.g. parameters and context, where the function was evaluated. One solution might involve manually recording function calls and parameters in a separate <em>data.frame</em> with the hope of maintaining synchrony with the output <em>data.frame</em>. However, this is prone to errors, e.g. during fast “copy and paste” operations or additions and deletions of parameter combinations. An alternative (and hopefully better) solution, is to use the framework of the <em>SummarizedBenchmark</em> package.</p>
<p>In the <em>SummarizedBenchmark</em> approach, a <em>BenchDesign</em> is constructed with the data and any number of methods. Optionally, a <em>BenchDesign</em> can also be constructed without any data or method inputs. Methods and data can be added or removed from the object modularly in a few different ways, as will be described in the following section. For simplicity, we first show how to construct the <em>BenchDesign</em> with just the data set as input. The data object, here <code>tdat</code>, must be passed explicitly to the <code>data =</code> parameter.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> tdat)</a></code></pre></div>
<p>Then, each method of interest can be added to the <em>BenchDesign</em> using <code><a href="../reference/addMethod.html">addMethod()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">bd =</span> b, <span class="dt">label =</span> <span class="st">"bonf"</span>, <span class="dt">func =</span> p.adjust,</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">               <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">p =</span> pval, <span class="dt">method =</span> <span class="st">"bonferroni"</span>))</a></code></pre></div>
<p>At a minimum, <code><a href="../reference/addMethod.html">addMethod()</a></code> requires three parameters:</p>
<ol style="list-style-type: decimal">
<li>
<code>bd</code>: the <em>BenchDesign</em> object to modify,</li>
<li>
<code>label</code>: a character name for the method, and</li>
<li>
<code>func</code>: the function to be called.</li>
</ol>
<p>After the minimum parameters are specified, any parameters needed by the <code>func</code> method should be passed as named parameters, e.g. <code>p = pval, method = "bonferroni"</code>, to <code>params =</code> as a list of <a href="http://rlang.tidyverse.org/reference/quosure.html"><em>quosures</em></a> using <code><a href="https://rlang.r-lib.org/reference/quotation.html">rlang::quos(..)</a></code>. Notice here that the <code>pval</code> wrapped in <code><a href="https://rlang.r-lib.org/reference/quotation.html">rlang::quos(..)</a></code> <strong>does not</strong> need to be specified as <code>tdat$pval</code> for the function to access the column in the data.frame. For readers familiar with the <em><a href="https://CRAN.R-project.org/package=ggplot2">ggplot2</a></em> package, the use of <code>params = rlang::quos(..)</code> here should be viewed similar to the use of <code>aes = aes(..)</code> in <code>ggplot2</code> for mapping between the data and plotting (or benchmarking) parameters.</p>
<p>The process of adding methods can be written more concisely using the pipe operators from the <em><a href="https://CRAN.R-project.org/package=magrittr">magrittr</a></em> package.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">b &lt;-<span class="st"> </span>b <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"BH"</span>,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">              <span class="dt">func =</span> p.adjust,</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">p =</span> pval, <span class="dt">method =</span> <span class="st">"BH"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"qv"</span>,</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">              <span class="dt">func =</span> qvalue<span class="op">::</span>qvalue,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">p =</span> pval),</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">              <span class="dt">post =</span> <span class="cf">function</span>(x) { x<span class="op">$</span>qvalues })</a></code></pre></div>
<p>For some methods, such as the q-value approach above, it may be necessary to call a “post-processing” function on the primary method to extract the desired output (here, the q-values). This should be specified using the optional <code>post =</code> parameter.</p>
<p>Now, the <em>BenchDesign</em> object contains three methods. This can be verified either by calling on the object.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">b</a></code></pre></div>
<pre><code>## BenchDesign ------------------------------------------------ 
##   benchmark data:
##     type: data 
##     names: H, test_statistic, effect_size, pval, SE 
##   benchmark methods:
##     method:  bonf; func: p.adjust       
##     method:    BH; func: p.adjust       
##     method:    qv; func: qvalue::qvalue</code></pre>
<p>More details about each method can be seen by using the <code><a href="../reference/printMethod.html">printMethods()</a></code> function.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="../reference/printMethod.html">printMethods</a></span>(b)</a></code></pre></div>
<pre><code>## bonf ------------------------------------------------------- 
## BenchDesign Method (BDMethod) ------------------------------ 
##   method: p.adjust
##     function (p, method = p.adjust.methods, n = length(p)... 
##   parameters:
##     p : pval 
##     method : "bonferroni" 
##   post:
##     none
##   meta:
##     none
## BH --------------------------------------------------------- 
## BenchDesign Method (BDMethod) ------------------------------ 
##   method: p.adjust
##     function (p, method = p.adjust.methods, n = length(p)... 
##   parameters:
##     p : pval 
##     method : "BH" 
##   post:
##     none
##   meta:
##     none
## qv --------------------------------------------------------- 
## BenchDesign Method (BDMethod) ------------------------------ 
##   method: qvalue::qvalue
##     function (p, fdr.level = NULL, pfdr = FALSE, lfdr.out... 
##   parameters:
##     p : pval 
##   post:
##     default : function (x) { ... 
##   meta:
##     none</code></pre>
<p>While the bench now includes all the information necessary for performing the benchmarking study, the actual adjusted p-values and q-values have not yet been calculated. To do this, we simply call <code><a href="../reference/buildBench.html">buildBench()</a></code>. While <code><a href="../reference/buildBench.html">buildBench()</a></code> does not require any inputs other than the <em>BenchDesign</em> object, when the corresponding ground truth is known, the <code>truthCols =</code> parameter should be specified. In this example, the <code>H</code> column of the <code>tdat</code> <em>data.frame</em> contains the true null or alternative status of each simulated hypothesis test. Note that if any of the methods are defined in a separate package, they must be installed and loaded <em>before</em> running the experiment.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(b, <span class="dt">truthCols =</span> <span class="st">"H"</span>)</a></code></pre></div>
<p>The returned object is a <em>SummarizedBenchmark</em> class. The <em>SummarizedBenchmark</em> object is an extension of a <em>SummarizedExperiment</em> object. The table of adjusted p-values and q-values is contained in a single “assay” of the object with each method added using <code><a href="../reference/addMethod.html">addMethod()</a></code> as a column with the corresponding <code>label</code> as the name.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">assay</span>(sb))</a></code></pre></div>
<pre><code>##            bonf         BH           qv
## [1,] 0.24361409 0.02191765 0.0079813228
## [2,] 1.00000000 0.90365415 0.3290660527
## [3,] 0.00103076 0.00103076 0.0003753518
## [4,] 1.00000000 0.12140444 0.0442094809
## [5,] 1.00000000 0.47127065 0.1716134119
## [6,] 1.00000000 0.48250104 0.1757029652</code></pre>
<p>Metadata for the methods is contained in the <code>colData()</code> of the same object, with each row corresponding to one method in the comparison.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">colData</span>(sb)</a></code></pre></div>
<pre><code>## DataFrame with 3 rows and 6 columns
##         func.pkg func.pkg.vers func.pkg.manual     param.p param.method
##      &lt;character&gt;   &lt;character&gt;       &lt;logical&gt; &lt;character&gt;  &lt;character&gt;
## bonf       stats         3.5.0           FALSE        pval "bonferroni"
## BH         stats         3.5.0           FALSE        pval         "BH"
## qv        qvalue        2.12.0           FALSE        pval           NA
##      session.idx
##        &lt;numeric&gt;
## bonf           1
## BH             1
## qv             1</code></pre>
<p>In addition to columns for the functions and parameters specified with <code><a href="../reference/addMethod.html">addMethod()</a></code> (<code>func, post, label, param.*</code>), the <code>colData()</code> includes several other columns added during the <code><a href="../reference/buildBench.html">buildBench()</a></code> process. Most notably, columns for the package name and version of <code>func</code> if available (<code>func.pkg</code>, <code>func.pkg.vers</code>).</p>
<p>When available, ground truth data is contained in the <code>rowData()</code> of the <em>SummarizedBenchmark</em> object.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">rowData</span>(sb)</a></code></pre></div>
<pre><code>## DataFrame with 50 rows and 1 column
##             H
##     &lt;numeric&gt;
## 1           1
## 2           0
## 3           1
## 4           1
## 5           1
## ...       ...
## 46          0
## 47          1
## 48          0
## 49          1
## 50          1</code></pre>
<p>In addition, the <em>SummarizedBenchmark</em> class contains an additional slot where users can define performance metrics to evaluate the different methods. Since different benchmarking experiments may require the use of different metrics to evaluate the performance of the methods, the <em>SummarizedBenchmark</em> class provides a flexible way to define performance metrics. We can define performance metrics using the function <code><a href="../reference/addPerformanceMetric.html">addPerformanceMetric()</a></code> by providing a <em>SummarizedBenchmark</em> object, a name of the metric, an assay name, and the function that defines it. Importantly, the function must contain the following two arguments: query (referring to a vector of values being evaluated, i.e. the output of one method) and truth (referring to the vector of ground truths). If further arguments are provided to the performance function, these must contain default values.</p>
<p>For our example, we define the performance metric “TPR” (True Positive Rate) that calculates the fraction of true positives recovered given an alpha value. This performance metric uses the <code>H</code> assay of our <em>SummarizedBenchmark</em> example object.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addPerformanceMetric.html">addPerformanceMetric</a></span>(</a>
<a class="sourceLine" id="cb22-2" data-line-number="2">  <span class="dt">object =</span> sb,</a>
<a class="sourceLine" id="cb22-3" data-line-number="3">  <span class="dt">assay =</span> <span class="st">"H"</span>,</a>
<a class="sourceLine" id="cb22-4" data-line-number="4">  <span class="dt">evalMetric =</span> <span class="st">"TPR"</span>,</a>
<a class="sourceLine" id="cb22-5" data-line-number="5">  <span class="dt">evalFunction =</span> <span class="cf">function</span>(query, truth, <span class="dt">alpha =</span> <span class="fl">0.1</span>) {</a>
<a class="sourceLine" id="cb22-6" data-line-number="6">    goodHits &lt;-<span class="st"> </span><span class="kw">sum</span>((query <span class="op">&lt;</span><span class="st"> </span>alpha) <span class="op">&amp;</span><span class="st"> </span>truth <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb22-7" data-line-number="7">    goodHits <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(truth <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb22-8" data-line-number="8">    }</a>
<a class="sourceLine" id="cb22-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb22-10" data-line-number="10"></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="kw"><a href="../reference/performanceMetrics.html">performanceMetrics</a></span>(sb)[[<span class="st">"H"</span>]]</a></code></pre></div>
<pre><code>## $TPR
## function (query, truth, alpha = 0.1) 
## {
##     goodHits &lt;- sum((query &lt; alpha) &amp; truth == 1)
##     goodHits/sum(truth == 1)
## }</code></pre>
<p>Having defined all the desired performance metrics, the function <code><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics()</a></code> calculates these for each method. Parameters for the performance functions can be passed here. In the case below, we specify several <code>alpha =</code> values to be used for calculating the performance metrics with each function.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">resWide &lt;-<span class="st"> </span><span class="kw"><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics</a></span>(sb, <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>))</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">resWide</a></code></pre></div>
<pre><code>## DataFrame with 3 rows and 9 columns
##         func.pkg func.pkg.vers func.pkg.manual     param.p param.method
##      &lt;character&gt;   &lt;character&gt;       &lt;logical&gt; &lt;character&gt;  &lt;character&gt;
## bonf       stats         3.5.0           FALSE        pval "bonferroni"
## BH         stats         3.5.0           FALSE        pval         "BH"
## qv        qvalue        2.12.0           FALSE        pval           NA
##      session.idx     TPR.1     TPR.2     TPR.3
##        &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;
## bonf           1     0.125       0.2     0.225
## BH             1     0.375      0.55     0.625
## qv             1       0.6       0.7       0.9</code></pre>
<p>By default, the function above returns a <em>DataFrame</em>, where the parameters of the performance function are stored in its <code>elementMetadata()</code>.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">elementMetadata</span>(resWide)</a></code></pre></div>
<pre><code>## DataFrame with 9 rows and 4 columns
##             colType       assay performanceMetric     alpha
##         &lt;character&gt; &lt;character&gt;       &lt;character&gt; &lt;numeric&gt;
## 1 methodInformation          NA                NA        NA
## 2 methodInformation          NA                NA        NA
## 3 methodInformation          NA                NA        NA
## 4 methodInformation          NA                NA        NA
## 5 methodInformation          NA                NA        NA
## 6 methodInformation          NA                NA        NA
## 7 performanceMetric           H               TPR      0.05
## 8 performanceMetric           H               TPR       0.1
## 9 performanceMetric           H               TPR       0.2</code></pre>
<p>A second possibility is to set the parameter <code>addColData = TRUE</code> for these results to be stored in the <code>colData()</code> of the <em>SummarizedBenchmark</em> object.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics</a></span>(sb, </a>
<a class="sourceLine" id="cb28-2" data-line-number="2">                                 <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>), </a>
<a class="sourceLine" id="cb28-3" data-line-number="3">                                 <span class="dt">addColData =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="kw">colData</span>(sb)</a></code></pre></div>
<pre><code>## DataFrame with 3 rows and 10 columns
##         func.pkg func.pkg.vers func.pkg.manual     param.p param.method
##      &lt;character&gt;   &lt;character&gt;       &lt;logical&gt; &lt;character&gt;  &lt;character&gt;
## bonf       stats         3.5.0           FALSE        pval "bonferroni"
## BH         stats         3.5.0           FALSE        pval         "BH"
## qv        qvalue        2.12.0           FALSE        pval           NA
##      session.idx     TPR.1     TPR.2     TPR.3 pm.session
##        &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;  &lt;numeric&gt;
## bonf           1     0.125       0.2     0.225          1
## BH             1     0.375      0.55     0.625          1
## qv             1       0.6       0.7       0.9          1</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw">elementMetadata</span>(<span class="kw">colData</span>(sb))</a></code></pre></div>
<pre><code>## DataFrame with 10 rows and 4 columns
##                     colType       assay performanceMetric     alpha
##                 &lt;character&gt; &lt;character&gt;       &lt;character&gt; &lt;numeric&gt;
## 1         methodInformation          NA                NA        NA
## 2         methodInformation          NA                NA        NA
## 3         methodInformation          NA                NA        NA
## 4         methodInformation          NA                NA        NA
## 5         methodInformation          NA                NA        NA
## 6         methodInformation          NA                NA        NA
## 7         performanceMetric           H               TPR      0.05
## 8         performanceMetric           H               TPR       0.1
## 9         performanceMetric           H               TPR       0.2
## 10 performanceMetricSession          NA                NA        NA</code></pre>
<p>Finally, if the user prefers tidier formats, by setting the parameter <code>tidy = TRUE</code> the function returns a long-formated version of the results.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw"><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics</a></span>(sb, </a>
<a class="sourceLine" id="cb32-2" data-line-number="2">                           <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>), </a>
<a class="sourceLine" id="cb32-3" data-line-number="3">                           <span class="dt">tidy =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##   func.pkg func.pkg.vers func.pkg.manual param.p param.method session.idx
## 1    stats         3.5.0           FALSE    pval "bonferroni"           1
## 2    stats         3.5.0           FALSE    pval         "BH"           1
## 3   qvalue        2.12.0           FALSE    pval         &lt;NA&gt;           1
## 4    stats         3.5.0           FALSE    pval "bonferroni"           1
## 5    stats         3.5.0           FALSE    pval         "BH"           1
## 6   qvalue        2.12.0           FALSE    pval         &lt;NA&gt;           1
## 7    stats         3.5.0           FALSE    pval "bonferroni"           1
## 8    stats         3.5.0           FALSE    pval         "BH"           1
## 9   qvalue        2.12.0           FALSE    pval         &lt;NA&gt;           1
##   pm.session label   key value assay performanceMetric alpha
## 1          1  bonf TPR.1 0.125     H               TPR  0.05
## 2          1    BH TPR.1 0.375     H               TPR  0.05
## 3          1    qv TPR.1 0.600     H               TPR  0.05
## 4          1  bonf TPR.2 0.200     H               TPR  0.10
## 5          1    BH TPR.2 0.550     H               TPR  0.10
## 6          1    qv TPR.2 0.700     H               TPR  0.10
## 7          1  bonf TPR.3 0.225     H               TPR  0.20
## 8          1    BH TPR.3 0.625     H               TPR  0.20
## 9          1    qv TPR.3 0.900     H               TPR  0.20</code></pre>
<p>As an alternative to get the same <em>data.frame</em> as the previous chunk, we can call the function <code><a href="../reference/tidyUpMetrics.html">tidyUpMetrics()</a></code> on the saved results from a <em>SummarizedBenchmark</em> object.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">head</span>(<span class="kw"><a href="../reference/tidyUpMetrics.html">tidyUpMetrics</a></span>(sb))</a></code></pre></div>
<pre><code>##   func.pkg func.pkg.vers func.pkg.manual param.p param.method session.idx
## 1    stats         3.5.0           FALSE    pval "bonferroni"           1
## 2    stats         3.5.0           FALSE    pval         "BH"           1
## 3   qvalue        2.12.0           FALSE    pval         &lt;NA&gt;           1
## 4    stats         3.5.0           FALSE    pval "bonferroni"           1
## 5    stats         3.5.0           FALSE    pval         "BH"           1
## 6   qvalue        2.12.0           FALSE    pval         &lt;NA&gt;           1
##   pm.session label   key value assay performanceMetric alpha
## 1          1  bonf TPR.1 0.125     H               TPR  0.05
## 2          1    BH TPR.1 0.375     H               TPR  0.05
## 3          1    qv TPR.1 0.600     H               TPR  0.05
## 4          1  bonf TPR.2 0.200     H               TPR  0.10
## 5          1    BH TPR.2 0.550     H               TPR  0.10
## 6          1    qv TPR.2 0.700     H               TPR  0.10</code></pre>
<p>For example, the code below extracts the TPR for an alpha of 0.1 for the Bonferroni method.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw"><a href="../reference/tidyUpMetrics.html">tidyUpMetrics</a></span>(sb) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="st">  </span>dplyr<span class="op">:::</span><span class="kw">filter</span>(label <span class="op">==</span><span class="st"> "bonf"</span>, alpha <span class="op">==</span><span class="st"> </span><span class="fl">0.1</span>, performanceMetric <span class="op">==</span><span class="st"> "TPR"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="st">  </span>dplyr<span class="op">:::</span><span class="kw">select</span>(value)</a></code></pre></div>
<pre><code>##   value
## 1   0.2</code></pre>
</div>
<div id="class-details" class="section level1">
<h1 class="hasAnchor">
<a href="#class-details" class="anchor"></a>Class Details</h1>
<p>Before moving to the second case study, we describe the anatomy of the <em>BenchDesign</em> and <em>SummarizedBenchmark</em> classes in a little more detail.</p>
<div id="benchdesign" class="section level2">
<h2 class="hasAnchor">
<a href="#benchdesign" class="anchor"></a>BenchDesign</h2>
<p>As noted in the previous section, <em>BenchDesign</em> objects are composed of a data set and methods. Formally, the methods are stored in the <em>BenchDesign</em> as a <em>BDMethodList</em> and the data as a <em>BDData</em> object. As would be expected, the <em>BDMethodList</em> is a list (<code>List</code>) of <em>BDMethod</em> objects, each containing the definition of a method to be compared in the benchmark experiment. The general structure is illustrated in the figure below.</p>
<div class="figure">
<img src="summarizedbenchmark-figure2.png" alt="BenchDesign class structure"><p class="caption">BenchDesign class structure</p>
</div>
<p>Continuing with the <em>BenchDesign</em> constructed in the example above, we can access the list of methods and the data set stored in the object using the <code><a href="../reference/BDMethodList.html">BDMethodList()</a></code> and <code><a href="../reference/BDData.html">BDData()</a></code> functions.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw"><a href="../reference/BDMethodList.html">BDMethodList</a></span>(b)</a></code></pre></div>
<pre><code>## BenchDesign Method List (BDMethodList) --------------------- 
## list of 3 methods 
##   method:  bonf; func: p.adjust       
##   method:    BH; func: p.adjust       
##   method:    qv; func: qvalue::qvalue</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw"><a href="../reference/BDData.html">BDData</a></span>(b)</a></code></pre></div>
<pre><code>## BenchDesign Data (BDData) ---------------------------------- 
##   type: data 
##   data:
##    H test_statistic effect_size         pval        SE
## 1  1     -3.2083437 -1.17151466 4.872282e-03 0.3651463
## 2  0      0.1692236  0.07321912 8.675080e-01 0.4326768
## 3  1     -5.7077940 -1.81715381 2.061521e-05 0.3183636
## 4  1     -1.9805856 -1.09107836 6.313031e-02 0.5508867
## 5  1     -1.0014358 -0.37726058 3.298895e-01 0.3767197
## 6  1     -0.9190433 -0.47583669 3.702252e-01 0.5177522
## 7  1     -1.3184486 -0.72750221 2.038846e-01 0.5517866
## 8  1     -3.8492346 -1.47787871 1.175116e-03 0.3839409
## 9  1     -3.4836213 -1.35474550 2.651401e-03 0.3888900
## 10 0      0.6238195  0.25470364 5.405719e-01 0.4082970
##  ... with 30 more rows.</code></pre>
<p>The list of methods inherits from the <em>SimpleList</em> class, and supports several useful accessor and setter features.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw"><a href="../reference/BDMethodList.html">BDMethodList</a></span>(b)[[<span class="st">"bonf"</span>]]</a></code></pre></div>
<pre><code>## BenchDesign Method (BDMethod) ------------------------------ 
##   method: p.adjust
##     function (p, method = p.adjust.methods, n = length(p)... 
##   parameters:
##     p : pval 
##     method : "bonferroni" 
##   post:
##     none
##   meta:
##     none</code></pre>
<p>This interface allows for adding new methods by creating a new named entry in the <em>BDMethodList</em> of the <em>BenchDesign</em> object.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw"><a href="../reference/BDMethodList.html">BDMethodList</a></span>(b)[[<span class="st">"bonf2"</span>]] &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BDMethodList.html">BDMethodList</a></span>(b)[[<span class="st">"bonf"</span>]]</a>
<a class="sourceLine" id="cb44-2" data-line-number="2">b</a></code></pre></div>
<pre><code>## BenchDesign ------------------------------------------------ 
##   benchmark data:
##     type: data 
##     names: H, test_statistic, effect_size, pval, SE 
##   benchmark methods:
##     method:   bonf; func: p.adjust       
##     method:     BH; func: p.adjust       
##     method:     qv; func: qvalue::qvalue 
##     method:  bonf2; func: p.adjust</code></pre>
<p>Methods can also be removed by setting the list value to NULL. An equivalent convenience function, <code><a href="../reference/dropMethod.html">dropMethod()</a></code> also exists for removing methods using syntax similar to <code><a href="../reference/addMethod.html">addMethod()</a></code>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw"><a href="../reference/BDMethodList.html">BDMethodList</a></span>(b)[[<span class="st">"bonf"</span>]] &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2">b</a></code></pre></div>
<pre><code>## BenchDesign ------------------------------------------------ 
##   benchmark data:
##     type: data 
##     names: H, test_statistic, effect_size, pval, SE 
##   benchmark methods:
##     method:     BH; func: p.adjust       
##     method:     qv; func: qvalue::qvalue 
##     method:  bonf2; func: p.adjust</code></pre>
<p>Each <em>BDMethod</em> object in a <em>BDMethodList</em> encapsulates a method to be benchmarked. The contents of the object are all of the arguments passed through the <code><a href="../reference/addMethod.html">addMethod()</a></code> convenience function used in the example above. New <em>BDMethod</em> objects can be constructed with the <code><a href="../reference/BDMethod.html">BDMethod()</a></code> constructor, which takes the same input parameters as <code><a href="../reference/addMethod.html">addMethod()</a></code>.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">bdm_bonf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BDMethod.html">BDMethod</a></span>(<span class="dt">x =</span> p.adjust, </a>
<a class="sourceLine" id="cb48-2" data-line-number="2">                     <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">p =</span> pval, </a>
<a class="sourceLine" id="cb48-3" data-line-number="3">                                          <span class="dt">method =</span> <span class="st">"bonferroni"</span>))</a>
<a class="sourceLine" id="cb48-4" data-line-number="4">bdm_bonf</a></code></pre></div>
<pre><code>## BenchDesign Method (BDMethod) ------------------------------ 
##   method: p.adjust
##     function (p, method = p.adjust.methods, n = length(p)... 
##   parameters:
##     p : pval 
##     method : "bonferroni" 
##   post:
##     none
##   meta:
##     none</code></pre>
<p>Directly modifying the <em>BDMethodList</em> object provides an alternative approach (aside form using <code><a href="../reference/addMethod.html">addMethod()</a></code>) to adding methods to a <em>BenchDesign</em> object.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="kw"><a href="../reference/BDMethodList.html">BDMethodList</a></span>(b)[[<span class="st">"bonf"</span>]] &lt;-<span class="st"> </span>bdm_bonf</a>
<a class="sourceLine" id="cb50-2" data-line-number="2">b</a></code></pre></div>
<pre><code>## BenchDesign ------------------------------------------------ 
##   benchmark data:
##     type: data 
##     names: H, test_statistic, effect_size, pval, SE 
##   benchmark methods:
##     method:     BH; func: p.adjust       
##     method:     qv; func: qvalue::qvalue 
##     method:  bonf2; func: p.adjust       
##     method:   bonf; func: p.adjust</code></pre>
<p>The <em>BDData</em> object is a simple object which only contains two slots, <code>@type</code> and <code>@data</code>. The <code>@type</code> of a <em>BDData</em> object can be either <code>data</code> or <code>hash</code>. If the <code>@type</code> is <code>data</code>, the <code>@data</code> slot is a standard list or data.frame object of raw data. However, if the <code>@type</code> is <code>hash</code>, then the <code>@data</code> slot is just a MD5 hash of some raw data object computed using <code><a href="http://www.rdocumentation.org/packages/digest/topics/digest">digest::digest()</a></code>. As described next in Section @ref(summarizedbenchmark), <em>SummarizedBenchmark</em> objects also contain the <em>BenchDesign</em> object used to generate the benchmark results. Often, the original raw data can be large, and saving the full data set as part of the <em>SummarizedBenchmark</em> object can be undesirable and unnecessary. While the raw data set is needed during the benchmark experiment, by default, the <em>BDData</em> is converted to a MD5 hash beforing stored the <em>BenchDesign</em> as part of a <em>SummarizedBenchmark</em> object. Using this approach, it is still possible to confirm whether a certain data set was used for a benchmarking experiment without having to store copies of the raw data with every <em>SummarizedBenchmark</em>.</p>
<p>Returning to the <em>BenchDesign</em> example from above, the <em>BDData</em> object of a <em>BenchDesign</em> can also be similarly extracted and modified. As with <em>BDMethod</em> objects, the data set may be removed by setting the value to NULL.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw"><a href="../reference/BDData.html">BDData</a></span>(b) &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2">b</a></code></pre></div>
<pre><code>## BenchDesign ------------------------------------------------ 
##   benchmark data:
##     NULL
##   benchmark methods:
##     method:     BH; func: p.adjust       
##     method:     qv; func: qvalue::qvalue 
##     method:  bonf2; func: p.adjust       
##     method:   bonf; func: p.adjust</code></pre>
<p>A new data set can be constructed using the <code><a href="../reference/BDData.html">BDData()</a></code> function and used to replace the data set in a <em>BenchDesign</em> object.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">bdd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BDData.html">BDData</a></span>(<span class="dt">data =</span> tdat)</a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="kw"><a href="../reference/BDData.html">BDData</a></span>(b) &lt;-<span class="st"> </span>bdd</a>
<a class="sourceLine" id="cb54-3" data-line-number="3">b</a></code></pre></div>
<pre><code>## BenchDesign ------------------------------------------------ 
##   benchmark data:
##     type: data 
##     names: H, test_statistic, effect_size, pval, SE 
##   benchmark methods:
##     method:     BH; func: p.adjust       
##     method:     qv; func: qvalue::qvalue 
##     method:  bonf2; func: p.adjust       
##     method:   bonf; func: p.adjust</code></pre>
<p>The helper function <code><a href="../reference/hashBDData.html">hashBDData()</a></code> can be called on either <em>BDData</em> or <em>BenchDesign</em> objects to convert the data to a MD5 hash. By default, this function is called on the <em>BenchDesign</em> object during <code><a href="../reference/buildBench.html">buildBench()</a></code> before storing the object in the resulting <em>SummarizedBenchmark</em>.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">b &lt;-<span class="st"> </span><span class="kw"><a href="../reference/hashBDData.html">hashBDData</a></span>(b)</a>
<a class="sourceLine" id="cb56-2" data-line-number="2">b</a></code></pre></div>
<pre><code>## BenchDesign ------------------------------------------------ 
##   benchmark data:
##     type: md5hash 
##     MD5 hash: 09867f2696d3178a8f3bc038917042e1 
##   benchmark methods:
##     method:     BH; func: p.adjust       
##     method:     qv; func: qvalue::qvalue 
##     method:  bonf2; func: p.adjust       
##     method:   bonf; func: p.adjust</code></pre>
<p>We drop the <code>"bonf2"</code> method from the object to return to the same set of methods used to generate the <em>SummarizedBenchmark</em> object.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"><span class="kw"><a href="../reference/BDMethodList.html">BDMethodList</a></span>(b)[[<span class="st">"bonf2"</span>]] &lt;-<span class="st"> </span><span class="ot">NULL</span></a></code></pre></div>
</div>
<div id="summarizedbenchmark" class="section level2">
<h2 class="hasAnchor">
<a href="#summarizedbenchmark" class="anchor"></a>SummarizedBenchmark</h2>
<p>As described above, the <em>SummarizedBenchmark</em> class builds on the existing <em>SummarizedExperiment</em> class and Bioconductor infrastructure. By doing so, saved results are tightly linked to metadata. Thus, it is possible, for example, to easily subset the results without losing references to the respective metadata. For example, the code below extracts the data for only the first two methods.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1">sbSub &lt;-<span class="st"> </span>sb[, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb59-2" data-line-number="2"><span class="kw">colData</span>(sbSub)</a></code></pre></div>
<pre><code>## DataFrame with 2 rows and 10 columns
##         func.pkg func.pkg.vers func.pkg.manual     param.p param.method
##      &lt;character&gt;   &lt;character&gt;       &lt;logical&gt; &lt;character&gt;  &lt;character&gt;
## bonf       stats         3.5.0           FALSE        pval "bonferroni"
## BH         stats         3.5.0           FALSE        pval         "BH"
##      session.idx     TPR.1     TPR.2     TPR.3 pm.session
##        &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;  &lt;numeric&gt;
## bonf           1     0.125       0.2     0.225          1
## BH             1     0.375      0.55     0.625          1</code></pre>
<p>Building on the <em>SummarizedExperiment</em> class, in addition to the slot for <code>performanceMetrics</code> described above, the <em>SummarizedBenchmark</em> class also includes a slot which stores a copy of the <em>BenchDesign</em> object used to generate the results with <code><a href="../reference/buildBench.html">buildBench()</a></code>. The <em>BenchDesign</em> can be accessed by simply passing the object to <code><a href="../reference/BenchDesign.html">BenchDesign()</a></code>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1"><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(sb)</a></code></pre></div>
<pre><code>## BenchDesign ------------------------------------------------ 
##   benchmark data:
##     type: md5hash 
##     MD5 hash: 09867f2696d3178a8f3bc038917042e1 
##   benchmark methods:
##     method:  bonf; func: p.adjust       
##     method:    BH; func: p.adjust       
##     method:    qv; func: qvalue::qvalue</code></pre>
<p>Notice, however, unlike the original <em>BenchDesign</em> above, the data is stored as a MD5 hash. To prevent bloat when the data set is large, by default, only a MD5 hash computed using <code><a href="http://www.rdocumentation.org/packages/digest/topics/digest">digest::digest()</a></code> is stored with the benchmarking results. This behavior can be changed by setting <code>keepData = TRUE</code> when calling <code><a href="../reference/buildBench.html">buildBench()</a></code>, in which case, the complete data set will be stored as part of the <em>BenchDesign</em> and <em>SummarizedBenchmark</em> objects. A simple helper function, <code><a href="../reference/compareBDData.html">compareBDData()</a></code>, can be used to verify that while the data <em>type</em> may be different between the data originally used to construct the <em>SummarizedBenchmark</em> and the data stored with the <em>SummarizedBenchmark</em>, the referenced data sets are the same (i.e. have matching MD5 hash values).</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="kw"><a href="../reference/compareBDData.html">compareBDData</a></span>(<span class="kw"><a href="../reference/BDData.html">BDData</a></span>(tdat), <span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(sb))</a></code></pre></div>
<pre><code>## $data
## [1] TRUE
## 
## $type
## [1] FALSE</code></pre>
<p>Finally, information about the R session where the methods were executed is stored in the metadata of the <em>SummarizedBenchmark</em> as an entry in a list called <code>sessions</code>. The package supports rerunning benchmark experiments, and for this purpose, each new session is stored as a new entry in the <code>sessions</code> list. Since this experiment has only been executed once, the list only has a single entry in the <code>sessions</code> list. In addition to storing the session info and list of methods evaluated during the session, the list also keeps track of all parameters in the <code><a href="../reference/buildBench.html">buildBench()</a></code> call, i.e. <code>truthCols = "H"</code>.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw">metadata</span>(sb)<span class="op">$</span>sessions[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## $methods
## [1] "bonf" "BH"   "qv"  
## 
## $results
## $results$bonf
## $results$bonf$default
## [1] "success"
## 
## 
## $results$BH
## $results$BH$default
## [1] "success"
## 
## 
## $results$qv
## $results$qv$default
## [1] "success"
## 
## 
## 
## $parameters
## $parameters$truthCols
## [1] "H"
## 
## $parameters$ftCols
## NULL
## 
## $parameters$sortIDs
## [1] FALSE
## 
## $parameters$keepData
## [1] FALSE
## 
## $parameters$catchErrors
## [1] TRUE
## 
## $parameters$parallel
## [1] FALSE
## 
## $parameters$BPPARAM
## class: MulticoreParam
##   bpisup: FALSE; bpnworkers: 2; bptasks: 0; bpjobname: BPJOB
##   bplog: FALSE; bpthreshold: INFO; bpstopOnError: TRUE
##   bptimeout: 2592000; bpprogressbar: FALSE
##   bpRNGseed: 
##   bplogdir: NA
##   bpresultdir: NA
##   cluster type: FORK
## 
## 
## $sessionInfo
## ─ Session info ──────────────────────────────────────────────────────────
##  setting  value                       
##  version  R version 3.5.0 (2018-04-23)
##  os       OS X El Capitan 10.11.6     
##  system   x86_64, darwin15.6.0        
##  ui       unknown                     
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       America/New_York            
##  date     2018-09-03                  
## 
## ─ Packages ──────────────────────────────────────────────────────────────
##  package              * version    date      
##  assertthat             0.2.0      2017-04-11
##  backports              1.1.2      2017-12-13
##  bindr                  0.1.1      2018-03-13
##  bindrcpp               0.2.2      2018-03-29
##  Biobase              * 2.40.0     2018-05-14
##  BiocGenerics         * 0.26.0     2018-05-14
##  BiocParallel         * 1.14.2     2018-07-08
##  BiocStyle            * 2.8.0      2018-05-14
##  bitops                 1.0-6      2013-08-17
##  bookdown               0.7        2018-02-18
##  clisymbols             1.2.0      2017-05-21
##  codetools              0.2-15     2016-10-05
##  colorspace             1.3-2      2016-12-14
##  commonmark             1.5        2018-04-28
##  crayon               * 1.3.4      2017-09-16
##  DelayedArray         * 0.6.0      2018-05-14
##  desc                   1.2.0      2018-05-01
##  digest               * 0.6.16     2018-08-22
##  dplyr                * 0.7.6      2018-06-29
##  evaluate               0.11       2018-07-17
##  fs                     1.2.6      2018-08-23
##  GenomeInfoDb         * 1.16.0     2018-05-14
##  GenomeInfoDbData       1.1.0      2018-05-14
##  GenomicRanges        * 1.32.6     2018-07-20
##  ggplot2              * 3.0.0      2018-07-03
##  glue                   1.3.0      2018-07-17
##  gridExtra              2.3        2017-09-09
##  gtable                 0.2.0      2016-02-26
##  htmltools              0.3.6      2017-04-28
##  IRanges              * 2.14.10    2018-08-20
##  knitr                  1.20       2018-02-20
##  lattice                0.20-35    2017-03-25
##  lazyeval               0.2.1      2017-10-29
##  magrittr             * 1.5        2014-11-22
##  MASS                   7.3-50     2018-04-30
##  Matrix                 1.2-14     2018-04-09
##  matrixStats          * 0.54.0     2018-07-23
##  mclust               * 5.4.1      2018-06-27
##  memoise                1.1.0      2017-04-21
##  munsell                0.5.0      2018-06-12
##  pillar                 1.3.0      2018-07-14
##  pkgconfig              2.0.2      2018-08-16
##  pkgdown                1.1.0      2018-06-02
##  plyr                   1.8.4      2016-06-08
##  purrr                  0.2.5      2018-05-29
##  qvalue                 2.12.0     2018-05-14
##  R6                     2.2.2      2017-06-17
##  Rcpp                   0.12.18    2018-07-23
##  RCurl                  1.95-4.11  2018-07-15
##  reshape2               1.4.3      2017-12-11
##  rlang                * 0.2.2.9000 2018-09-03
##  rmarkdown              1.10       2018-06-11
##  roxygen2               6.1.0      2018-07-27
##  rprojroot              1.3-2      2018-01-03
##  S4Vectors            * 0.18.3     2018-07-20
##  scales                 1.0.0      2018-08-09
##  sessioninfo          * 1.0.0      2017-06-21
##  stringi                1.2.4      2018-07-20
##  stringr              * 1.3.1      2018-05-10
##  SummarizedBenchmark  * 1.99.2     2018-09-03
##  SummarizedExperiment * 1.10.1     2018-05-14
##  tibble               * 1.4.2      2018-01-22
##  tidyr                * 0.8.1      2018-05-18
##  tidyselect             0.2.4      2018-02-26
##  UpSetR               * 1.3.3      2017-03-21
##  withr                  2.1.2      2018-03-15
##  xfun                   0.3        2018-07-06
##  xml2                   1.2.0      2018-01-24
##  XVector                0.20.0     2018-05-14
##  yaml                   2.2.0      2018-07-25
##  zlibbioc               1.26.0     2018-05-14
##  source                          
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  Bioconductor                    
##  Bioconductor                    
##  cran (@1.14.2)                  
##  Bioconductor                    
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  Bioconductor                    
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  cran (@0.7.6)                   
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  Bioconductor                    
##  Bioconductor                    
##  cran (@1.32.6)                  
##  cran (@3.0.0)                   
##  cran (@1.3.0)                   
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  cran (@2.14.10)                 
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  cran (@5.4.1)                   
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  cran (@0.2.5)                   
##  Bioconductor                    
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  Github (tidyverse/rlang@5505474)
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  cran (@0.18.3)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  Bioconductor                    
##  Bioconductor                    
##  CRAN (R 3.5.0)                  
##  cran (@0.8.1)                   
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  CRAN (R 3.5.0)                  
##  Bioconductor                    
##  CRAN (R 3.5.0)                  
##  Bioconductor</code></pre>
</div>
<div id="reproducibility-and-replicability" class="section level2">
<h2 class="hasAnchor">
<a href="#reproducibility-and-replicability" class="anchor"></a>Reproducibility and Replicability</h2>
<p>While the <em>BenchDesign</em> and <em>SummarizedBenchmark</em> classes are designed to enable easier reproduction and replication of benchmark experiments, they are not meant to completely replace properly written and documented analyses. If any functions or packages are needed for the methods defined in the <em>BenchDesign</em>, they must be available and sourced or loaded when running (or re-running) the analyses. As an example, suppose we have the following locally defined method, <code>mymethod()</code>, which depends on another locally defined, but unavailable, function, <code>mysubmethod()</code>.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">mymethod &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb67-2" data-line-number="2">    <span class="kw">mysubmethod</span>(x)</a>
<a class="sourceLine" id="cb67-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb67-4" data-line-number="4">mybd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">vals =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>))</a>
<a class="sourceLine" id="cb67-5" data-line-number="5">mybd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(mybd, <span class="st">"method1"</span>, mymethod,</a>
<a class="sourceLine" id="cb67-6" data-line-number="6">                  <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">x =</span> vals))</a></code></pre></div>
<p>The top level <code>mymethod()</code> is captured in the corresponding <em>BDMethod</em> and <em>BenchDesign</em>. No errors are thrown since including <code>mymethod()</code> in a <em>BenchDesign</em> object does not require evaluating the function.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"><span class="kw"><a href="../reference/BDMethod.html">BDMethod</a></span>(mybd, <span class="st">"method1"</span>)<span class="op">@</span>f</a></code></pre></div>
<pre><code>## function(x) {
##     mysubmethod(x)
## }</code></pre>
<p>However, when <code><a href="../reference/buildBench.html">buildBench()</a></code> is called, the method naturally fails because the necessary <code>mysubmethod()</code> is not available in the current session.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="kw">tryCatch</span>({ <span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(mybd) }, <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="kw">print</span>(e))</a></code></pre></div>
<pre><code>## !! error caught in buildBench !!
## !! error in main function of method: 'method1'</code></pre>
<pre><code>## !!  original message: 
## !!  could not find function "mysubmethod"</code></pre>
<pre><code>## &lt;simpleError in buildBench(mybd): 
## No method returned valid values for any assays!
## &gt;</code></pre>
<p>Therefore, if any locally defined functions are necessary for a method, they should be available along with the <em>BenchDesign</em> object or defined at the top level. Additionally, for reproducibility and clarity, we generally recommend keeping functions as “self-contained” as possible, and <em>never</em> relying on variables defined externally, e.g. in the global enviroment. Scoping with functions can be confusing, and it may not always be clear where constants are being evaluated. As an example, consider the following simple multiplying function.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">m &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2">mymult &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb74-3" data-line-number="3">    m <span class="op">*</span><span class="st"> </span>x</a>
<a class="sourceLine" id="cb74-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb74-5" data-line-number="5">m &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb74-6" data-line-number="6"></a>
<a class="sourceLine" id="cb74-7" data-line-number="7">mybd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">vals =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">m =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb74-8" data-line-number="8">mybd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(mybd, <span class="st">"methodr"</span>, mymult,</a>
<a class="sourceLine" id="cb74-9" data-line-number="9">                  <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">x =</span> vals))</a></code></pre></div>
<p>While experienced R programmers may know which value of <code>m</code> (5, 2 or 10) will be used when <code><a href="../reference/buildBench.html">buildBench()</a></code> is called, for many users, this is less obvious.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="kw">assay</span>(<span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(mybd))</a></code></pre></div>
<pre><code>##      methodr
## [1,]       2
## [2,]       4
## [3,]       6
## [4,]       8
## [5,]      10</code></pre>
<p>The answer is the value assigned most recently in the environment where <code>mymult()</code> was defined, <code>R_GlobalEnv</code>, the global environment (<code>m = 2</code>). Note, however, that if the <em>BenchDesign</em> is saved and reloaded in a new session, whatever value of <code>m</code> is defined in the global environment of the new session will be used. If <code>m</code> is not defined in the new session, an error will be thrown. In this case, <code>m</code> should either be explicitly defined within the function or passed as a second input variable of <code>mymult()</code> and defined with <code>params =</code> in the <em>BDMethod</em>.</p>
<p>While it may be possible to aggressively capture all code and environment variables defined with each method in a <em>BenchDesign</em>, it is not within the scope of this package, and furthermore, may not be the best appraoch to constructing a reproducible benchmark. While redundant, for emphasis, we reiterate that the <em>SummarizedBenchmark</em> framework is a solution for structuring benchmark experiments which complements, but does not replace, well documented and organized code.</p>
</div>
</div>
<div id="differential-expression-case-study" class="section level1">
<h1 class="hasAnchor">
<a href="#differential-expression-case-study" class="anchor"></a>Differential Expression Case Study</h1>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"limma"</span>)</a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="kw">library</span>(<span class="st">"edgeR"</span>)</a>
<a class="sourceLine" id="cb77-3" data-line-number="3"><span class="kw">library</span>(<span class="st">"DESeq2"</span>)</a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="kw">library</span>(<span class="st">"tximport"</span>)</a></code></pre></div>
<p>In this more advanced case study, we use a simulated data set from <span class="citation">(Soneson and Robinson 2016)</span> to demonstrate how the <em>SummarizedBenchmark</em> package can be used to benchmark methods for differential expression analysis. Namely, we compare the methods implemented in the <em><a href="http://bioconductor.org/packages/DESeq2">DESeq2</a></em>, <em><a href="http://bioconductor.org/packages/edgeR">edgeR</a></em>, and <em><a href="http://bioconductor.org/packages/limma">limma</a></em> packages. The simulated data set includes 6 samples of three replicates each from two conditions. For each sample, transcript-level expression is provided as transcripts per-million (TPM) values for 15,677 transcripts from human chromosome 1 (Ensembl GRCh37.71). A more complete description of the data, including code for how the data ws generated, is available in the Supplementary Materials of <span class="citation">(Soneson and Robinson 2016)</span> <a href="http://dx.doi.org/10.5256/f1000research.7563.d114722">here</a>. We provide precomputed objects containing these count and ground truth data.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="kw">data</span>(<span class="st">"soneson2016"</span>)</a>
<a class="sourceLine" id="cb78-2" data-line-number="2"><span class="kw">head</span>(txi<span class="op">$</span>counts)</a></code></pre></div>
<pre><code>##                         A1          A2         A3         B1        B2
## ENST00000367770   1.670571   0.8064829   5.472561  58.700418  32.89297
## ENST00000367771 558.834722 458.8887676 662.352695   5.299743  20.73813
## ENST00000367772 155.881534 110.6033685 183.417201   0.000000   0.00000
## ENST00000423670  11.809207  16.4752934  10.426669  20.392491   1.26733
## ENST00000470238  96.489863  34.2755231  32.489730 785.514128 614.71261
## ENST00000286031  12.442872  13.4797855   4.781290   1.152118  20.50770
##                         B3
## ENST00000367770  16.648100
## ENST00000367771  14.862318
## ENST00000367772   0.000000
## ENST00000423670   7.546371
## ENST00000470238 815.123229
## ENST00000286031   5.760588</code></pre>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="kw">head</span>(truthdat)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 13
##   transcript status logFC_cat   logFC avetpm length eff_length   tpm1  tpm2
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;int&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 ENST00000…      1 [ 3.38,3…   4.17   0.225   2916      2771. 0.0237 0.427
## 2 ENST00000…      1 [ 3.38,3…   5.25   3.20    2921      2776. 6.23   0.164
## 3 ENST00000…      1 Inf       Inf      0.817   3477      3332. 1.63   0    
## 4 ENST00000…      1 [ 0.00, …   0.322  0.203   2077      1932. 0.181  0.226
## 5 ENST00000…      1 [ 3.38,3…   4.07   4.08    1538      1393. 0.460  7.71 
## 6 ENST00000…      0 [ 0.00, …   0      0.154   4355      4210. 0.154  0.154
## # ... with 4 more variables: isopct1 &lt;dbl&gt;, isopct2 &lt;dbl&gt;, gene &lt;chr&gt;,
## #   avetpm_cat &lt;chr&gt;</code></pre>
<div id="benchmark-set-up-and-execution" class="section level2">
<h2 class="hasAnchor">
<a href="#benchmark-set-up-and-execution" class="anchor"></a>Benchmark Set-Up and Execution</h2>
<p>We begin the benchmarking process by creating our <em>BenchDesign</em> object with the data set. The <em>BenchDesign</em> can be initialized with a <em>data.frame</em> (as in the case study above), or more generally, with a list object. In this case study, since methods for differential expression require more than just the expression counts, e.g. the experimental design, we construct a list containing each of these inputs as a named entry.</p>
<p>The scaled TPM values are rounded before passing to the differential expression methods.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1">mycounts &lt;-<span class="st"> </span><span class="kw">round</span>(txi<span class="op">$</span>counts)</a></code></pre></div>
<p>Here, we simply use the the conditions for each sample to define the experimental design. The design matrix is stored as a <em>data.frame</em>, <code>mycoldat</code>.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">mycoldat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">condition =</span> <span class="kw">factor</span>(<span class="kw">rep</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="dt">each =</span> <span class="dv">3</span>)))</a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="kw">rownames</span>(mycoldat) &lt;-<span class="st"> </span><span class="kw">colnames</span>(mycounts)</a></code></pre></div>
<p>The data object for the benchmark experiment is now constructed with both the counts and the design matrix, along with some ground truth information (“status”: the true presence or absence of differential expression between conditions, and “lfc”: the expected log-fold change between conditions).</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1">mydat &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">coldat =</span> mycoldat,</a>
<a class="sourceLine" id="cb84-2" data-line-number="2">              <span class="dt">cntdat =</span> mycounts,</a>
<a class="sourceLine" id="cb84-3" data-line-number="3">              <span class="dt">status =</span> truthdat<span class="op">$</span>status,</a>
<a class="sourceLine" id="cb84-4" data-line-number="4">              <span class="dt">lfc =</span> truthdat<span class="op">$</span>logFC)</a></code></pre></div>
<p>As before, the <em>BenchDesign</em> is constructed with the data as the sole input.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">bd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> mydat)</a></code></pre></div>
<p>For simplicity, we focus on comparing only the p-values returned by each method after testing for differential expression between the two conditions. However, later in this vignette, we also show how multiple metrics (p-values and log-fold change) can be compared in a single <em>BenchDesign</em> object.</p>
<p>Since each method requires running multiple steps, we write wrapper functions which return only the vector of p-values for each method.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1">deseq2_pvals &lt;-<span class="st"> </span><span class="cf">function</span>(countData, colData, design, contrast) {</a>
<a class="sourceLine" id="cb86-2" data-line-number="2">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeqDataSet">DESeqDataSetFromMatrix</a></span>(countData,</a>
<a class="sourceLine" id="cb86-3" data-line-number="3">                                  <span class="dt">colData =</span> colData,</a>
<a class="sourceLine" id="cb86-4" data-line-number="4">                                  <span class="dt">design =</span> design)</a>
<a class="sourceLine" id="cb86-5" data-line-number="5">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeq">DESeq</a></span>(dds)</a>
<a class="sourceLine" id="cb86-6" data-line-number="6">    res &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/results">results</a></span>(dds, <span class="dt">contrast =</span> contrast)</a>
<a class="sourceLine" id="cb86-7" data-line-number="7">    res<span class="op">$</span>pvalue</a>
<a class="sourceLine" id="cb86-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb86-9" data-line-number="9"></a>
<a class="sourceLine" id="cb86-10" data-line-number="10">edgeR_pvals &lt;-<span class="st"> </span><span class="cf">function</span>(countData, group, design) {</a>
<a class="sourceLine" id="cb86-11" data-line-number="11">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/DGEList">DGEList</a></span>(countData, <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb86-12" data-line-number="12">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/calcNormFactors">calcNormFactors</a></span>(y)</a>
<a class="sourceLine" id="cb86-13" data-line-number="13">    des &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(design)</a>
<a class="sourceLine" id="cb86-14" data-line-number="14">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/estimateDisp">estimateDisp</a></span>(y, des)</a>
<a class="sourceLine" id="cb86-15" data-line-number="15">    fit &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/glmfit">glmFit</a></span>(y, des)</a>
<a class="sourceLine" id="cb86-16" data-line-number="16">    lrt &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/glmfit">glmLRT</a></span>(fit, <span class="dt">coef=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb86-17" data-line-number="17">    lrt<span class="op">$</span>table<span class="op">$</span>PValue</a>
<a class="sourceLine" id="cb86-18" data-line-number="18">}</a>
<a class="sourceLine" id="cb86-19" data-line-number="19"></a>
<a class="sourceLine" id="cb86-20" data-line-number="20">voom_pvals &lt;-<span class="st"> </span><span class="cf">function</span>(countData, group, design) {</a>
<a class="sourceLine" id="cb86-21" data-line-number="21">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/DGEList">DGEList</a></span>(countData, <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb86-22" data-line-number="22">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/calcNormFactors">calcNormFactors</a></span>(y)</a>
<a class="sourceLine" id="cb86-23" data-line-number="23">    des &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(design)</a>
<a class="sourceLine" id="cb86-24" data-line-number="24">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/voom">voom</a></span>(y, des)</a>
<a class="sourceLine" id="cb86-25" data-line-number="25">    eb &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/ebayes">eBayes</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/lmFit">lmFit</a></span>(y, des))</a>
<a class="sourceLine" id="cb86-26" data-line-number="26">    eb<span class="op">$</span>p.value[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb86-27" data-line-number="27">}</a></code></pre></div>
<p>Next, each method is added to the <em>BenchDesign</em> using <code><a href="../reference/addMethod.html">addMethod()</a></code>, and the corresponding wrapper function passed as <code>func</code>. (For a review of the basic usage of <code><a href="../reference/addMethod.html">addMethod()</a></code>, revisit Section @ref(quickstart-case-study).) We again use the pipe notation for compactness.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">bd &lt;-<span class="st"> </span>bd <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"deseq2"</span>,</a>
<a class="sourceLine" id="cb87-3" data-line-number="3">              <span class="dt">func =</span> deseq2_pvals,</a>
<a class="sourceLine" id="cb87-4" data-line-number="4">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb87-5" data-line-number="5">                                   <span class="dt">colData =</span> coldat, </a>
<a class="sourceLine" id="cb87-6" data-line-number="6">                                   <span class="dt">design =</span> <span class="op">~</span>condition,</a>
<a class="sourceLine" id="cb87-7" data-line-number="7">                                   <span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>))</a>
<a class="sourceLine" id="cb87-8" data-line-number="8">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"edgeR"</span>,</a>
<a class="sourceLine" id="cb87-10" data-line-number="10">              <span class="dt">func =</span> edgeR_pvals,</a>
<a class="sourceLine" id="cb87-11" data-line-number="11">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb87-12" data-line-number="12">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb87-13" data-line-number="13">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)</a>
<a class="sourceLine" id="cb87-14" data-line-number="14">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-15" data-line-number="15"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"voom"</span>,</a>
<a class="sourceLine" id="cb87-16" data-line-number="16">              <span class="dt">func =</span> voom_pvals,</a>
<a class="sourceLine" id="cb87-17" data-line-number="17">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb87-18" data-line-number="18">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb87-19" data-line-number="19">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)</a>
<a class="sourceLine" id="cb87-20" data-line-number="20">              )</a></code></pre></div>
<p>So far, none of the methods have been executed. The <em>BenchDesign</em> object simply serves as a container describing <em>how</em> the methods should be executed. The methods are applied by a simple call to <code><a href="../reference/buildBench.html">buildBench()</a></code>. Since the ground truth is known and available in <code>mydat$status</code>, this is specified to <code>truthCols=</code>.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(bd, <span class="dt">truthCols =</span> <span class="st">"status"</span>)</a></code></pre></div>
<p>We can inspect the results.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1">sb</a></code></pre></div>
<pre><code>## class: SummarizedBenchmark 
## dim: 15677 3 
## metadata(1): sessions
## assays(1): status
## rownames: NULL
## rowData names(1): status
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx</code></pre>
</div>
<div id="benchmark-evaluation" class="section level2">
<h2 class="hasAnchor">
<a href="#benchmark-evaluation" class="anchor"></a>Benchmark Evaluation</h2>
<p>By running the code above, the results of three differential expression methods (<em><a href="http://bioconductor.org/packages/edgeR">edgeR</a></em>, <em><a href="http://bioconductor.org/packages/limma">limma</a></em>-voom and <em><a href="http://bioconductor.org/packages/DESeq2">DESeq2</a></em> will be stored in a <code>SummarizedBenchmark</code> container. The next step is to define metrics to evaluate the performance of these three methods. This can be done by using the function <code><a href="../reference/addPerformanceMetric.html">addPerformanceMetric()</a></code>, as described before in Section @ref(quickstart-case-study). However, in this package there are implementations for several ‘default’ metrics that are commonly used to evaluate methods. The function <code><a href="../reference/availableMetrics.html">availableMetrics()</a></code> returns a <em>data.frame</em> of these metrics.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="kw"><a href="../reference/availableMetrics.html">availableMetrics</a></span>()</a></code></pre></div>
<pre><code>##            functions                                   description
## 1         rejections                          Number of rejections
## 2                TPR                            True Positive Rate
## 3                TNR                            True Negative Rate
## 4                FDR              False Discovery Rate (estimated)
## 5                FNR                           False Negative Rate
## 6        correlation                           Pearson correlation
## 7               sdad Standard Deviation of the Absolute Difference
## 8            hamming                              Hamming distance
## 9             LPnorm                                    L_{p} norm
## 10 adjustedRandIndex                           Adjusted Rand Index
##    requiresTruth
## 1          FALSE
## 2           TRUE
## 3           TRUE
## 4           TRUE
## 5           TRUE
## 6           TRUE
## 7           TRUE
## 8           TRUE
## 9           TRUE
## 10          TRUE</code></pre>
<p>For example, the predefined metrics <code>rejections</code>, <code>TPR</code>, <code>TNR</code>, <code>FDR</code> and <code>FNR</code> can be added to the assay <code>H</code> of our object using the following code,</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addPerformanceMetric.html">addPerformanceMetric</a></span>( sb, </a>
<a class="sourceLine" id="cb93-2" data-line-number="2">                            <span class="dt">evalMetric=</span><span class="kw">c</span>(<span class="st">"rejections"</span>, <span class="st">"TPR"</span>, <span class="st">"TNR"</span>, <span class="st">"FDR"</span>, <span class="st">"FNR"</span>),</a>
<a class="sourceLine" id="cb93-3" data-line-number="3">                            <span class="dt">assay=</span><span class="st">"status"</span> )</a>
<a class="sourceLine" id="cb93-4" data-line-number="4"><span class="kw">names</span>(<span class="kw"><a href="../reference/performanceMetrics.html">performanceMetrics</a></span>(sb)[[<span class="st">"status"</span>]])</a></code></pre></div>
<pre><code>## [1] "rejections" "TPR"        "TNR"        "FDR"        "FNR"</code></pre>
<p>Having defined the desired performance metrics, the function <code><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics()</a></code> will calculate these metrics for each of the three methods.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw"><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics</a></span>(</a>
<a class="sourceLine" id="cb95-2" data-line-number="2">  sb, </a>
<a class="sourceLine" id="cb95-3" data-line-number="3">  <span class="dt">alpha =</span> <span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>), </a>
<a class="sourceLine" id="cb95-4" data-line-number="4">  <span class="dt">tidy =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-5" data-line-number="5"><span class="st">  </span>dplyr<span class="op">:::</span><span class="kw">select</span>(label, value, performanceMetric, alpha) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb95-6" data-line-number="6"><span class="st">  </span><span class="kw">tail</span>()</a></code></pre></div>
<pre><code>##     label      value performanceMetric alpha
## 55 deseq2 0.10988246               FNR   0.1
## 56  edgeR 0.09381113               FNR   0.1
## 57   voom 0.11381970               FNR   0.1
## 58 deseq2 0.09223211               FNR   0.2
## 59  edgeR 0.07986767               FNR   0.2
## 60   voom 0.08741018               FNR   0.2</code></pre>
<p>Furthermore, the functions <code><a href="../reference/plotMethodsOverlap.html">plotMethodsOverlap()</a></code> and <code><a href="../reference/plotROC.html">plotROC()</a></code> are helpful to visualize the performance of the different methods, in case these methods output q-values.</p>
<p><code><a href="../reference/plotMethodsOverlap.html">plotMethodsOverlap()</a></code> is a wrapper for the function <code>upset()</code> from the <em><a href="https://CRAN.R-project.org/package=UpSetR">UpSetR</a></em> package that is helpful to visualize the overlaps between hits of different methods for a given alpha value.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="kw"><a href="../reference/plotMethodsOverlap.html">plotMethodsOverlap</a></span>( sb, <span class="dt">assay=</span><span class="st">"status"</span>, <span class="dt">alpha=</span><span class="fl">0.1</span>, <span class="dt">order.by=</span><span class="st">"freq"</span>)</a></code></pre></div>
<p><img src="../docs/articles/SummarizedBenchmark_files/figure-html/unnamed-chunk-52-1.png" width="432"></p>
<p>From the plot above, it is evident that there is a large number of transcripts that are detected to be differentially expressed by all three methods. There are also smallers sets of transcripts that are detected uniquely by a single method or subsets of methods. Another typical way to compare the performance of different methods are Receiver Operating Characteristic (ROC) curves. The function <code><a href="../reference/plotROC.html">plotROC()</a></code> inputs a <em>SummarizeBenchmark</em> object and draws the ROC curves for all methods contained in it.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1">SummarizedBenchmark<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/SummarizedBenchmark/topics/plotROC">plotROC</a></span>(sb, <span class="dt">assay=</span><span class="st">"status"</span>)</a></code></pre></div>
<p><img src="../docs/articles/SummarizedBenchmark_files/figure-html/unnamed-chunk-53-1.png" width="480"></p>
</div>
</div>
<div id="additional-features" class="section level1">
<h1 class="hasAnchor">
<a href="#additional-features" class="anchor"></a>Additional Features</h1>
<p>Here, we describe several additional features implemented in <em>SummarizedBenchmark</em> for building on the standard workflow described in the previous sections. The features are illustrated using the same differential expression example from above.</p>
<div id="reusing-a-benchdesign-across-data-sets" class="section level2">
<h2 class="hasAnchor">
<a href="#reusing-a-benchdesign-across-data-sets" class="anchor"></a>Reusing a BenchDesign Across Data Sets</h2>
<p>When benchmarking several methods, it is generally considered good practice to apply the methods to more than just a single data set. Under the SummarizedBenchmark framework, this naturally translates to recycling the same set of methods defined in a single <em>BenchDesign</em> object across multiple data sets. As mentioned early on, a <em>BenchDesign</em> can be intialized without any methods or data set.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">bdnull &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>()</a>
<a class="sourceLine" id="cb99-2" data-line-number="2">bdnull</a></code></pre></div>
<pre><code>## BenchDesign ------------------------------------------------ 
##   benchmark data:
##     NULL
##   benchmark methods:
##     none</code></pre>
<p>As before, methods can be added to the <em>BenchDesign</em> with <code><a href="../reference/addMethod.html">addMethod()</a></code>, and the benchmark experiment run using <code><a href="../reference/buildBench.html">buildBench()</a></code>.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1">bdnull &lt;-<span class="st"> </span>bdnull <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"bonf"</span>,</a>
<a class="sourceLine" id="cb101-3" data-line-number="3">              <span class="dt">func =</span> p.adjust,</a>
<a class="sourceLine" id="cb101-4" data-line-number="4">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">p =</span> pval,</a>
<a class="sourceLine" id="cb101-5" data-line-number="5">                                   <span class="dt">method =</span> <span class="st">"bonferroni"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb101-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"BH"</span>,</a>
<a class="sourceLine" id="cb101-7" data-line-number="7">              <span class="dt">func =</span> p.adjust,</a>
<a class="sourceLine" id="cb101-8" data-line-number="8">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">p =</span> pval,</a>
<a class="sourceLine" id="cb101-9" data-line-number="9">                                   <span class="dt">method =</span> <span class="st">"BH"</span>))</a></code></pre></div>
<p>The <code><a href="../reference/buildBench.html">buildBench()</a></code> method accepts an optional <code>data =</code> parameter. When specified, this data set is used to run the experiment, taking precedence over the data set specified in (or missing from) the <em>BenchDesign</em> object.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" data-line-number="1"><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(bdnull, <span class="dt">data =</span> tdat)</a></code></pre></div>
<pre><code>## class: SummarizedBenchmark 
## dim: 50 2 
## metadata(1): sessions
## assays(1): default
## rownames: NULL
## rowData names(1): default
## colnames(2): bonf BH
## colData names(6): func.pkg func.pkg.vers ... param.method
##   session.idx</code></pre>
<p>By specifying data during the <code><a href="../reference/buildBench.html">buildBench()</a></code> step, the exact same benchmark comparison, as defined in the common <em>BenchDesign</em> object, can be carried out consistently across multiple data sets. While this approach works even if the common <em>BenchDesign</em> object contains a default data set, it is recommended that the <em>BenchDesign</em> be created without any data to avoid errors if the design is going to be reused across data sets.</p>
</div>
<div id="storing-multiple-outputs" class="section level2">
<h2 class="hasAnchor">
<a href="#storing-multiple-outputs" class="anchor"></a>Storing Multiple Outputs</h2>
<p>The differential expression case study described above has assumed that we are interested in a single numeric vector for each method, namely, a vector of p-values. These p-values are stored as the sole <code>assay</code> in the <em>SummarizedBenchmark</em> object returned by <code><a href="../reference/buildBench.html">buildBench()</a></code>. However, in many cases, there are multiple values of interest to be compared across methods. For example, looking at the estimated log-fold changes in addition to p-values may be informative when comparing methods for differential expression.</p>
<p>The <em>BenchDesign</em> framework supports multiple assays with the <code>post =</code> parameter of the <code><a href="../reference/addMethod.html">addMethod()</a></code> call. When zero or one function is specified to <code>post =</code> for all methods, as in the examples above, the results are stored as a single <code>assay</code>. However, if <code>post =</code> is passed a named list of functions, separate <code>assay</code>s will be created using the names and functions in each list. Since the <code>assay</code> names are taken from <code>post =</code>, all entries in the list must be named. Furthermore, since results are matched across methods using the assay names, if a method is missing a <code>post =</code> function for a given assay name, the corresponding column in the <code>assay</code>s will be set to <code>NA</code>.</p>
<p>To track both p-values and log-fold change values for each method, we write new wrapper functions. Separate wrapper functions are written for first returning the primary analysis results, and separate accessor functions for extracting p-values and log-fold changes from the results.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1">deseq2_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, colData, design, contrast) {</a>
<a class="sourceLine" id="cb104-2" data-line-number="2">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeqDataSet">DESeqDataSetFromMatrix</a></span>(countData,</a>
<a class="sourceLine" id="cb104-3" data-line-number="3">                                  <span class="dt">colData =</span> colData,</a>
<a class="sourceLine" id="cb104-4" data-line-number="4">                                  <span class="dt">design =</span> design)</a>
<a class="sourceLine" id="cb104-5" data-line-number="5">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeq">DESeq</a></span>(dds)</a>
<a class="sourceLine" id="cb104-6" data-line-number="6">    <span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/results">results</a></span>(dds, <span class="dt">contrast =</span> contrast)</a>
<a class="sourceLine" id="cb104-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb104-8" data-line-number="8">deseq2_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb104-9" data-line-number="9">    x<span class="op">$</span>pvalue</a>
<a class="sourceLine" id="cb104-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb104-11" data-line-number="11">deseq2_lfc &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb104-12" data-line-number="12">    x<span class="op">$</span>log2FoldChange</a>
<a class="sourceLine" id="cb104-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb104-14" data-line-number="14"></a>
<a class="sourceLine" id="cb104-15" data-line-number="15">edgeR_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, group, design) {</a>
<a class="sourceLine" id="cb104-16" data-line-number="16">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/DGEList">DGEList</a></span>(countData, <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb104-17" data-line-number="17">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/calcNormFactors">calcNormFactors</a></span>(y)</a>
<a class="sourceLine" id="cb104-18" data-line-number="18">    des &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(design)</a>
<a class="sourceLine" id="cb104-19" data-line-number="19">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/estimateDisp">estimateDisp</a></span>(y, des)</a>
<a class="sourceLine" id="cb104-20" data-line-number="20">    fit &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/glmfit">glmFit</a></span>(y, des)</a>
<a class="sourceLine" id="cb104-21" data-line-number="21">    <span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/glmfit">glmLRT</a></span>(fit, <span class="dt">coef=</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb104-22" data-line-number="22">}</a>
<a class="sourceLine" id="cb104-23" data-line-number="23">edgeR_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb104-24" data-line-number="24">    x<span class="op">$</span>table<span class="op">$</span>PValue</a>
<a class="sourceLine" id="cb104-25" data-line-number="25">}</a>
<a class="sourceLine" id="cb104-26" data-line-number="26">edgeR_lfc &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb104-27" data-line-number="27">    x<span class="op">$</span>table<span class="op">$</span>logFC</a>
<a class="sourceLine" id="cb104-28" data-line-number="28">}</a>
<a class="sourceLine" id="cb104-29" data-line-number="29"></a>
<a class="sourceLine" id="cb104-30" data-line-number="30">voom_run &lt;-<span class="st"> </span><span class="cf">function</span>(countData, group, design) {</a>
<a class="sourceLine" id="cb104-31" data-line-number="31">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/DGEList">DGEList</a></span>(countData, <span class="dt">group =</span> group)</a>
<a class="sourceLine" id="cb104-32" data-line-number="32">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/edgeR/topics/calcNormFactors">calcNormFactors</a></span>(y)</a>
<a class="sourceLine" id="cb104-33" data-line-number="33">    des &lt;-<span class="st"> </span><span class="kw">model.matrix</span>(design)</a>
<a class="sourceLine" id="cb104-34" data-line-number="34">    y &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/voom">voom</a></span>(y, des)</a>
<a class="sourceLine" id="cb104-35" data-line-number="35">    <span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/ebayes">eBayes</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/limma/topics/lmFit">lmFit</a></span>(y, des))</a>
<a class="sourceLine" id="cb104-36" data-line-number="36">}</a>
<a class="sourceLine" id="cb104-37" data-line-number="37">voom_pv &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb104-38" data-line-number="38">    x<span class="op">$</span>p.value[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb104-39" data-line-number="39">}</a>
<a class="sourceLine" id="cb104-40" data-line-number="40">voom_lfc &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb104-41" data-line-number="41">    x<span class="op">$</span>coefficients[, <span class="dv">2</span>]</a>
<a class="sourceLine" id="cb104-42" data-line-number="42">}</a></code></pre></div>
<p>The primary wrapper function and a list of accessor functions are passed to <code>func =</code> and <code>post =</code> respectively.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">bd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> mydat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"deseq2"</span>,</a>
<a class="sourceLine" id="cb105-3" data-line-number="3">              <span class="dt">func =</span> deseq2_run,</a>
<a class="sourceLine" id="cb105-4" data-line-number="4">              <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">pv =</span> deseq2_pv,</a>
<a class="sourceLine" id="cb105-5" data-line-number="5">                          <span class="dt">lfc =</span> deseq2_lfc),</a>
<a class="sourceLine" id="cb105-6" data-line-number="6">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb105-7" data-line-number="7">                                   <span class="dt">colData =</span> coldat, </a>
<a class="sourceLine" id="cb105-8" data-line-number="8">                                   <span class="dt">design =</span> <span class="op">~</span>condition,</a>
<a class="sourceLine" id="cb105-9" data-line-number="9">                                   <span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>))</a>
<a class="sourceLine" id="cb105-10" data-line-number="10">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-11" data-line-number="11"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"edgeR"</span>,</a>
<a class="sourceLine" id="cb105-12" data-line-number="12">              <span class="dt">func =</span> edgeR_run,</a>
<a class="sourceLine" id="cb105-13" data-line-number="13">              <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">pv =</span> edgeR_pv,</a>
<a class="sourceLine" id="cb105-14" data-line-number="14">                          <span class="dt">lfc =</span> edgeR_lfc),</a>
<a class="sourceLine" id="cb105-15" data-line-number="15">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb105-16" data-line-number="16">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb105-17" data-line-number="17">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)</a>
<a class="sourceLine" id="cb105-18" data-line-number="18">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-19" data-line-number="19"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"voom"</span>,</a>
<a class="sourceLine" id="cb105-20" data-line-number="20">              <span class="dt">func =</span> voom_run,</a>
<a class="sourceLine" id="cb105-21" data-line-number="21">              <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">pv =</span> voom_pv,</a>
<a class="sourceLine" id="cb105-22" data-line-number="22">                          <span class="dt">lfc =</span> voom_lfc),</a>
<a class="sourceLine" id="cb105-23" data-line-number="23">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb105-24" data-line-number="24">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb105-25" data-line-number="25">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)</a>
<a class="sourceLine" id="cb105-26" data-line-number="26">              )</a></code></pre></div>
<p>When the <em>BenchDesign</em> is evaluated using <code><a href="../reference/buildBench.html">buildBench()</a></code>, the resulting <em>SummarizedBenchmark</em> will be generated with two assays: <code>"pv"</code> and <code>"lfc"</code>. As before, the ground truth can be specified using the <code>truthCols =</code> parameter. When multiple assays are used, <code>truthCols =</code> expects a named vector of <code>assay-name = "column-name"</code> pairs.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(<span class="dt">bd =</span> bd, <span class="dt">truthCols =</span> <span class="kw">c</span>(<span class="dt">pv =</span> <span class="st">"status"</span>, <span class="dt">lfc =</span> <span class="st">"lfc"</span>))</a>
<a class="sourceLine" id="cb106-2" data-line-number="2">sb</a></code></pre></div>
<pre><code>## class: SummarizedBenchmark 
## dim: 15677 3 
## metadata(1): sessions
## assays(2): pv lfc
## rownames: NULL
## rowData names(2): pv lfc
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx</code></pre>
<p>We can verify that the two assays contain the expected values.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">assay</span>(sb, <span class="st">"pv"</span>))</a></code></pre></div>
<pre><code>##            deseq2        edgeR         voom
## [1,] 2.875541e-04 2.074073e-04 6.103023e-03
## [2,] 2.799371e-23 2.121422e-16 1.239445e-04
## [3,] 8.450676e-14 3.109331e-18 5.221157e-06
## [4,] 6.930834e-01 6.621236e-01 3.357040e-01
## [5,] 2.479616e-11 2.468951e-09 3.978989e-04
## [6,] 9.057130e-01 8.947438e-01 5.199404e-01</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">assay</span>(sb, <span class="st">"lfc"</span>))</a></code></pre></div>
<pre><code>##          deseq2       edgeR       voom
## [1,]  3.7329019   3.6767779  3.5232524
## [2,] -5.3905346  -5.3773940 -5.5543949
## [3,] -9.7125453 -10.2467488 -8.2533275
## [4,] -0.4706410  -0.4547095 -1.0510456
## [5,]  3.7048724   3.7024426  3.9084940
## [6,] -0.1554938  -0.1504299 -0.7607029</code></pre>
</div>
<div id="parallelizing-with-biocparallel" class="section level2">
<h2 class="hasAnchor">
<a href="#parallelizing-with-biocparallel" class="anchor"></a>Parallelizing with BiocParallel</h2>
<p>The simple examples considered in this vignette were constructed to be computational manageable with only one core. However, when working with larger data sets, running each method in serial with a single machine is often undesirable. Similarly, when replicating benchmark experiments across multiple data sets, running each experiment in serial may be inefficent. In this section, we describe how to use the <code><a href="http://www.rdocumentation.org/packages/BiocStyle/topics/macros">BiocStyle::Biocpkg("BiocParallel")</a></code> package to parallelize benchmarking across methods and data sets. More details on how to specify the parallelization back-end can be found in the <em>Introduction to BiocParallel</em> vignette for the <em><a href="http://bioconductor.org/packages/BiocParallel">BiocParallel</a></em> package.</p>
<div id="across-methods" class="section level3">
<h3 class="hasAnchor">
<a href="#across-methods" class="anchor"></a>Across Methods</h3>
<p>Since constructing a <em>BenchDesign</em> object requires no computation, the bottleneck only appears at the <code><a href="../reference/buildBench.html">buildBench()</a></code> step of the process. Parallelization of this step is enabled using the <em><a href="http://bioconductor.org/packages/BiocParallel">BiocParallel</a></em> package. By default, parallel evaluation is disabled, but can easily be enabled by setting <code>parallel = TRUE</code> and optionally specifying the <code>BPPARAM =</code> parameter. If <code>BPPARAM =</code> is not specified, the default back-end will be used. The default back-end can be checked with <code>bpparam()</code>.</p>
<p>Parallelization of <code><a href="../reference/buildBench.html">buildBench()</a></code> is carried out across the set of methods specified with <code><a href="../reference/addMethod.html">addMethod()</a></code>. Thus, there is no benefit to specifying more cores than the number of methods.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">bpparam</span>()</a></code></pre></div>
<pre><code>## class: MulticoreParam
##   bpisup: FALSE; bpnworkers: 2; bptasks: 0; bpjobname: BPJOB
##   bplog: FALSE; bpthreshold: INFO; bpstopOnError: TRUE
##   bptimeout: 2592000; bpprogressbar: FALSE
##   bpRNGseed: 
##   bplogdir: NA
##   bpresultdir: NA
##   cluster type: FORK</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">sbp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(bd, <span class="dt">parallel =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb114-2" data-line-number="2">                  <span class="dt">BPPARAM =</span> BiocParallel<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/BiocParallel/topics/SerialParam-class">SerialParam</a></span>())</a>
<a class="sourceLine" id="cb114-3" data-line-number="3">sbp</a></code></pre></div>
<pre><code>## class: SummarizedBenchmark 
## dim: 15677 3 
## metadata(1): sessions
## assays(2): pv lfc
## rownames: NULL
## rowData names(2): pv lfc
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx</code></pre>
<p>The results, as expected, are the same as when <code><a href="../reference/buildBench.html">buildBench()</a></code> was called without parallelization.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" data-line-number="1"><span class="kw">all</span>(<span class="kw">assay</span>(sbp) <span class="op">==</span><span class="st"> </span><span class="kw">assay</span>(sb), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="across-datasets" class="section level3">
<h3 class="hasAnchor">
<a href="#across-datasets" class="anchor"></a>Across Datasets</h3>
<p>Typically, benchmark studies have more than a single dataset. For this cases, users can create a <em>BenchDesign</em> object and execute this design on many datasets. Again, running the step of executing the benchmark design on every dataset using a single core might take to long. However, parallelization across datasets is possible using the <em><a href="http://bioconductor.org/packages/BiocParallel">BiocParallel</a></em> package.</p>
<p>To demonstrate this, we split the count data and ground truths of the <span class="citation">(Soneson and Robinson 2016)</span> dataset, as if they were three different datasets.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1"><span class="co">#mydat &lt;- as.list( bd@data@data )</span></a>
<a class="sourceLine" id="cb118-2" data-line-number="2">ndat &lt;-<span class="st"> </span><span class="kw">length</span>(mydat<span class="op">$</span>status)</a>
<a class="sourceLine" id="cb118-3" data-line-number="3">spIndexes &lt;-<span class="st"> </span><span class="kw">split</span>( <span class="kw">seq_len</span>( ndat ), <span class="kw">rep</span>( <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">length.out=</span>ndat ) )</a>
<a class="sourceLine" id="cb118-4" data-line-number="4"></a>
<a class="sourceLine" id="cb118-5" data-line-number="5">datasetList &lt;-<span class="st"> </span><span class="kw">lapply</span>( spIndexes, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb118-6" data-line-number="6">  <span class="kw">list</span>( <span class="dt">coldat=</span>mydat<span class="op">$</span>coldat, </a>
<a class="sourceLine" id="cb118-7" data-line-number="7">        <span class="dt">cntdat=</span>mydat<span class="op">$</span>cntdat[x,], </a>
<a class="sourceLine" id="cb118-8" data-line-number="8">        <span class="dt">status=</span>mydat<span class="op">$</span>status[x], </a>
<a class="sourceLine" id="cb118-9" data-line-number="9">        <span class="dt">lfc=</span>mydat<span class="op">$</span>lfc[x] )</a>
<a class="sourceLine" id="cb118-10" data-line-number="10">} )</a>
<a class="sourceLine" id="cb118-11" data-line-number="11"><span class="kw">names</span>( datasetList ) &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb118-12" data-line-number="12"><span class="st">  </span><span class="kw">c</span>(<span class="st">"dataset1"</span>, <span class="st">"dataset2"</span>, <span class="st">"dataset3"</span>)</a></code></pre></div>
<p>Then, using a call to <code>bplapply()</code> function, we can execute the <em>BenchDesign</em> object for each dataset. Note that with the <code>BPPARAM =</code> parameter, the execution of the <em>BenchDesign</em> is done across many computing instances. In the example below, we use 3 cores.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1">sbL &lt;-<span class="st"> </span><span class="kw">bplapply</span>( datasetList, <span class="cf">function</span>( x ){</a>
<a class="sourceLine" id="cb119-2" data-line-number="2">  <span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>( bd, <span class="dt">data=</span>x )</a>
<a class="sourceLine" id="cb119-3" data-line-number="3">}, <span class="dt">BPPARAM =</span> <span class="kw">MulticoreParam</span>( <span class="dv">3</span> ) )</a>
<a class="sourceLine" id="cb119-4" data-line-number="4">sbL</a></code></pre></div>
<pre><code>## $dataset1
## class: SummarizedBenchmark 
## dim: 5226 3 
## metadata(1): sessions
## assays(2): pv lfc
## rownames: NULL
## rowData names(2): pv lfc
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx
## 
## $dataset2
## class: SummarizedBenchmark 
## dim: 5226 3 
## metadata(1): sessions
## assays(2): pv lfc
## rownames: NULL
## rowData names(2): pv lfc
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx
## 
## $dataset3
## class: SummarizedBenchmark 
## dim: 5225 3 
## metadata(1): sessions
## assays(2): pv lfc
## rownames: NULL
## rowData names(2): pv lfc
## colnames(3): deseq2 edgeR voom
## colData names(9): func.pkg func.pkg.vers ... param.group
##   session.idx</code></pre>
</div>
</div>
<div id="updating-analyses" class="section level2">
<h2 class="hasAnchor">
<a href="#updating-analyses" class="anchor"></a>Updating Analyses</h2>
<p>Often, benchmarking analyses are performed in multiple steps, iteratively, with methods added or updated based on previous results. Additionally, over the course of a benchmarking study, developers may update methods to improve the implementation or add new features. Ideally, whenever a methods are updated or added, the benchmark results should also be updated. Naively, all methods in the benchmark could be re-computed by calling <code><a href="../reference/buildBench.html">buildBench()</a></code> on the original <em>BenchDesign</em> whenever the benchmarker notices that a method has been changed. However, not only is this computational inefficient, but requires the benchmarker to manually check if any methods have been verified.</p>
<p>To make this process easier, the package includes the <code><a href="../reference/updateBench.html">updateBench()</a></code> function which can be used to both check if any results in a <em>SummarizedBenchmark</em> object need to be updated, and to update these results with a call to <code><a href="../reference/buildBench.html">buildBench()</a></code>.</p>
<p>To demonstrate the use of <code><a href="../reference/updateBench.html">updateBench()</a></code>, we continue with the example of comparing methods for differential expression. First, the function can be called with just a single <em>SummarizedBenchmark</em> object to see if any of the methods have become outdated. By default, the function will not actually run any methods.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>(<span class="dt">sb =</span> sb)</a></code></pre></div>
<pre><code>## Update SummarizedBenchmark (dryrun) ---------------------------------- 
##   benchmark data: unchanged (full data missing)
##     MD5 hash: 3f41eeab0a157bf127e2b7ffb98ab685 
##     names: ??
##   benchmark methods:
##     |              | Need to  |           Outdated            |
##     | Method       | (Re)Run  |  Func Param  Meta  Post  Vers |
##     | deseq2       |       N  |     N     N     N     N     N |
##     | edgeR        |       N  |     N     N     N     N     N |
##     | voom         |       N  |     N     N     N     N     N |</code></pre>
<p>The output is a table showing whether any methods need to be re-evaluated, as well as which components of the methods are now outdated. Here, the headings correspond to:</p>
<ul>
<li>
<code>Func</code>: the main method function,</li>
<li>
<code>Param</code>: the method parameters,</li>
<li>
<code>Meta</code>: the manually specified method metadata,</li>
<li>
<code>Post</code>: the post-processing functions,</li>
<li>
<code>Vers</code>: the corresponding package version for the main method.</li>
</ul>
<p>As can be seen by the <code>N</code>s under <code>Need to (Re)Run</code>, all results in the <em>SummarizedBenchmark</em> are still valid, and no method needs to be re-run. Also note that the benchmark data is listed as <code>full data missing</code>. This is because the <em>SummarizedBenchmark</em> object only contains the data set as a MD5 hash. If any of the methods needed to be updated, the original data would have to be specified to <code><a href="../reference/updateBench.html">updateBench()</a></code> using the <code>data =</code> parameter.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="kw"><a href="../reference/BDData.html">BDData</a></span>(<span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(sb))</a></code></pre></div>
<pre><code>## BenchDesign Data (BDData) ---------------------------------- 
##   type: md5hash 
##   MD5 hash: 3f41eeab0a157bf127e2b7ffb98ab685</code></pre>
<p>The second way to call <code><a href="../reference/updateBench.html">updateBench()</a></code> is to specify both a <em>SummarizedBenchmark</em> object and a <em>BenchDesign</em> object. Intuitively, this will result in updating the results of the <em>SummarizedBenchmark</em> object to include any new or modified methods in the <em>BenchDesign</em>. Methods between the two objects are matched by the method label, e.g. <code>deseq2</code>. As an example, suppose we modify one of the methods in the <em>BenchDesign</em> object and want to rerun the benchmarking experiment. We first create a modified <em>BenchDesign</em> object, where we modify a single method’s manually specified meta data. Note that this is just a trivial update and normally would not warrant updating the results.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">bd2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/modifyMethod.html">modifyMethod</a></span>(bd, <span class="st">"deseq2"</span>, rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">bd.meta =</span> <span class="kw">list</span>(<span class="dt">note =</span> <span class="st">"minor update"</span>)))</a></code></pre></div>
<p>Next, we pass the object to <code><a href="../reference/updateBench.html">updateBench()</a></code> along with the original <em>SummarizedBenchmark</em> object.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>(<span class="dt">sb =</span> sb, <span class="dt">bd =</span> bd2)</a></code></pre></div>
<pre><code>## Update SummarizedBenchmark (dryrun) ---------------------------------- 
##   benchmark data: unchanged
##     MD5 hash: 3f41eeab0a157bf127e2b7ffb98ab685 
##     names: coldat cntdat status lfc 
##   benchmark methods:
##     |              | Need to  |           Outdated            |
##     | Method       | (Re)Run  |  Func Param  Meta  Post  Vers |
##     | deseq2       |       Y  |     N     N     Y     N     N |
##     | edgeR        |       N  |     N     N     N     N     N |
##     | voom         |       N  |     N     N     N     N     N |</code></pre>
<p>Notice that now the <code>Need to (Re)Run</code> and <code>Meta</code> columns are now set to <code>Y</code> for the <code>deseq2</code> method, indicating that the metadata of the method has been updated, and the method now needs to be rerun. Next, suppose we also decide to add a new method to our comparison. Here, we add an alternate version of DESeq2 to the comparison based on adaptive shrinkage (ASH) <span class="citation">(Stephens 2017)</span>.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1">deseq2_ashr &lt;-<span class="st"> </span><span class="cf">function</span>(countData, colData, design, contrast) {</a>
<a class="sourceLine" id="cb128-2" data-line-number="2">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeqDataSet">DESeqDataSetFromMatrix</a></span>(countData,</a>
<a class="sourceLine" id="cb128-3" data-line-number="3">                                  <span class="dt">colData =</span> colData,</a>
<a class="sourceLine" id="cb128-4" data-line-number="4">                                  <span class="dt">design =</span> design)</a>
<a class="sourceLine" id="cb128-5" data-line-number="5">    dds &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/DESeq">DESeq</a></span>(dds)</a>
<a class="sourceLine" id="cb128-6" data-line-number="6">    <span class="kw"><a href="http://www.rdocumentation.org/packages/DESeq2/topics/lfcShrink">lfcShrink</a></span>(dds, <span class="dt">contrast =</span> contrast, <span class="dt">type =</span> <span class="st">"ashr"</span>)</a>
<a class="sourceLine" id="cb128-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb128-8" data-line-number="8"></a>
<a class="sourceLine" id="cb128-9" data-line-number="9">bd2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(bd2, <span class="st">"deseq2_ashr"</span>, </a>
<a class="sourceLine" id="cb128-10" data-line-number="10">                 deseq2_ashr,</a>
<a class="sourceLine" id="cb128-11" data-line-number="11">                 <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">pv =</span> deseq2_pv,</a>
<a class="sourceLine" id="cb128-12" data-line-number="12">                             <span class="dt">lfc =</span> deseq2_lfc),</a>
<a class="sourceLine" id="cb128-13" data-line-number="13">                 <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb128-14" data-line-number="14">                                      <span class="dt">colData =</span> coldat, </a>
<a class="sourceLine" id="cb128-15" data-line-number="15">                                      <span class="dt">design =</span> <span class="op">~</span>condition,</a>
<a class="sourceLine" id="cb128-16" data-line-number="16">                                      <span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>)))</a></code></pre></div>
<p>Now we see that bo the modified <code>deseq2</code> and <code>deseq2_ashr</code> methods are listed as needing to be rerun.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1"><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>(<span class="dt">sb =</span> sb, <span class="dt">bd =</span> bd2)</a></code></pre></div>
<pre><code>## Update SummarizedBenchmark (dryrun) ---------------------------------- 
##   benchmark data: unchanged
##     MD5 hash: 3f41eeab0a157bf127e2b7ffb98ab685 
##     names: coldat cntdat status lfc 
##   benchmark methods:
##     |              | Need to  |           Outdated            |
##     | Method       | (Re)Run  |  Func Param  Meta  Post  Vers |
##     | deseq2       |       Y  |     N     N     Y     N     N |
##     | edgeR        |       N  |     N     N     N     N     N |
##     | voom         |       N  |     N     N     N     N     N |
##     | deseq2_ashr  |       Y  |     -     -     -     -     - |</code></pre>
<p>To run the update, we simply modify the call to <code><a href="../reference/updateBench.html">updateBench()</a></code> with <code>dryrun = FALSE</code>. When we do this, only the two methods needing to be rerun are evaluated.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">sb2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>(<span class="dt">sb =</span> sb, <span class="dt">bd =</span> bd2, <span class="dt">dryrun =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb131-2" data-line-number="2">sb2</a></code></pre></div>
<pre><code>## class: SummarizedBenchmark 
## dim: 15677 4 
## metadata(1): sessions
## assays(2): pv lfc
## rownames: NULL
## rowData names(2): pv lfc
## colnames(4): edgeR voom deseq2_ashr deseq2
## colData names(10): func.pkg func.pkg.vers ... session.idx
##   meta.note</code></pre>
<p>We can check the output to see that the results of the <code>deseq2_ashr</code> method have been added along with the updated <code>deseq2</code> results.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">assay</span>(sb2, <span class="st">"lfc"</span>))</a></code></pre></div>
<pre><code>##            edgeR       voom deseq2_ashr     deseq2
## [1,]   3.6767779  3.5232524  3.40956564  3.7329019
## [2,]  -5.3773940 -5.5543949 -5.32293234 -5.3905346
## [3,] -10.2467488 -8.2533275 -9.20816346 -9.7125453
## [4,]  -0.4547095 -1.0510456 -0.08956318 -0.4706410
## [5,]   3.7024426  3.9084940  3.61844615  3.7048724
## [6,]  -0.1504299 -0.7607029 -0.02921228 -0.1554938</code></pre>
<p>Additionally, notice that a session index is also stored in the column data of each method. This can be used to map methods quickly to the corresponding entry of the <code>sessions</code> list stored in the object metadata.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="kw">colData</span>(sb2)[, <span class="st">"session.idx"</span>, drop =<span class="st"> </span><span class="ot">FALSE</span>]</a></code></pre></div>
<pre><code>## DataFrame with 4 rows and 1 column
##             session.idx
##               &lt;numeric&gt;
## edgeR                 1
## voom                  1
## deseq2_ashr           2
## deseq2                2</code></pre>
<p>Recall, <code>sessions</code> is a list of session information stored in the metadata of the <em>SummarizedBenchmark</em> object. Each entry of the <code>sessions</code> list includes the names of methods for which the results were generated during that session, the corresponding method results, the run parameters, and the session info. We can check the list of methods for each session and see that it matches the <code>session.idx</code> values above.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="kw">lapply</span>(<span class="kw">metadata</span>(sb2)<span class="op">$</span>sessions, <span class="st">`</span><span class="dt">[[</span><span class="st">`</span>, <span class="st">"methods"</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] "edgeR" "voom" 
## 
## [[2]]
## [1] "deseq2_ashr" "deseq2"</code></pre>
<p>As another example, we can also compare the new <em>SummarizedBenchmark</em> object against the original <em>BenchDesign</em>. By default, <code><a href="../reference/updateBench.html">updateBench()</a></code> will keep all methods in the <em>SummarizedBenchmark</em> object even if a corresponding method is not found in the new <em>BenchDesign</em> object. To avoid this behavior, we can specify <code>keepAll = FALSE</code>.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>(sb2, bd, <span class="dt">keepAll =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Update SummarizedBenchmark (dryrun) ---------------------------------- 
##   benchmark data: unchanged
##     MD5 hash: 3f41eeab0a157bf127e2b7ffb98ab685 
##     names: coldat cntdat status lfc 
##   benchmark methods:
##     |              | Need to  |           Outdated            |
##     | Method       | (Re)Run  |  Func Param  Meta  Post  Vers |
##     | deseq2       |       Y  |     N     N     Y     N     N |
##     | edgeR        |       N  |     N     N     N     N     N |
##     | voom         |       N  |     N     N     N     N     N |
##     | deseq2_ashr  |    Drop  |     -     -     -     -     - |</code></pre>
<p>As expected, the <code>deseq2</code> method must again be updated to return to match the original method definition, and the newer <code>deseq2_ashr</code> method must be dropped.</p>
<p>If users update the <em>BenchDesign</em>, it is possible to calculate the performance metrics only for methods that have been added or modified. This feature is useful, for example, when performance metrics are computationally expensive to calculate. In the example below, we calculate the number of rejections at a FDR of 10%.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/addPerformanceMetric.html">addPerformanceMetric</a></span>( sb, </a>
<a class="sourceLine" id="cb141-2" data-line-number="2">                      <span class="dt">assay=</span><span class="st">"pv"</span>, </a>
<a class="sourceLine" id="cb141-3" data-line-number="3">                      <span class="dt">evalMetric=</span><span class="st">"rejections"</span>, </a>
<a class="sourceLine" id="cb141-4" data-line-number="4">                      <span class="dt">evalFunction=</span><span class="cf">function</span>( query, truth  ){ </a>
<a class="sourceLine" id="cb141-5" data-line-number="5">                        <span class="kw">sum</span>( <span class="kw">p.adjust</span>( query, <span class="dt">method=</span><span class="st">"BH"</span> ) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>, <span class="dt">na.rm=</span><span class="ot">TRUE</span>) </a>
<a class="sourceLine" id="cb141-6" data-line-number="6">                        } )</a>
<a class="sourceLine" id="cb141-7" data-line-number="7">sb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics</a></span>(sb, <span class="dt">addColData=</span><span class="ot">TRUE</span>)</a></code></pre></div>
<p>Then, we update the <em>BenchDesign</em> and rerun the function <code><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics()</a></code> with the parameter <code>rerun=FALSE</code>. Setting this parameter to <code>FALSE</code> will detect which performance metrics have been calculated before and will only recalculate metrics for methods that have been added or modified.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1">sb2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/updateBench.html">updateBench</a></span>( sb, bd2, <span class="dt">dryrun=</span><span class="ot">FALSE</span> )</a>
<a class="sourceLine" id="cb142-2" data-line-number="2"><span class="kw"><a href="../reference/estimateMetrics.html">estimatePerformanceMetrics</a></span>( sb2, <span class="dt">rerun=</span><span class="ot">FALSE</span>, <span class="dt">addColData=</span><span class="ot">TRUE</span> )</a></code></pre></div>
<pre><code>## 
## Option rerun is set to `FALSE`:
## Rerunning performance metrics only for the following methods: deseq2_ashr, deseq2</code></pre>
<pre><code>## class: SummarizedBenchmark 
## dim: 15677 4 
## metadata(1): sessions
## assays(2): pv lfc
## rownames: NULL
## rowData names(2): pv lfc
## colnames(4): edgeR voom deseq2_ashr deseq2
## colData names(12): func.pkg func.pkg.vers ... pm.session meta.note</code></pre>
</div>
<div id="error-handling" class="section level2">
<h2 class="hasAnchor">
<a href="#error-handling" class="anchor"></a>Error Handling</h2>
<p>When running a large benchmark study, not uncommonly, a single or a small subset of methods may fail during execution. This may be the result of misspecified parameters, an underlying bug in the software, or any number of other reasons. By default, errors thrown by methods which fail during <code><a href="../reference/buildBench.html">buildBench()</a></code> or <code><a href="../reference/updateBench.html">updateBench()</a></code> are caught and handled in a user-friendly way. As long as a single method executes without any errors, a <em>SummarizedBenchmark</em> object is returned as usual, with the assay columns of failed methods set to <code>NA</code>. Additionally, the corresponding error messages are stored in the metadata of the object for reference.</p>
<p>As an example, consider the following example where we run case where we benchmark two simple methods. The first, <code>slowMethod</code> draws 5 random normal samples after waiting 5 seconds, and the second, <code>fastMethod</code> draws 5 random normal samples immediately. Each method is then passed through two post-processing functions, <code>keepSlow</code> and <code>makeSlower</code>, and <code>keepFast</code> and <code>makeSlower</code>, respectively. This results in three partially overlapping assays, <code>keepSlow</code>, <code>keepFast</code> and <code>makeSlower</code>. With this example, we also demonstrate how mismatched assays are handled across methods.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1">bdslow &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> tdat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="st">"slowMethod"</span>, <span class="cf">function</span>() { <span class="kw">Sys.sleep</span>(<span class="dv">5</span>); <span class="kw">rnorm</span>(<span class="dv">5</span>) },</a>
<a class="sourceLine" id="cb145-3" data-line-number="3">              <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">keepSlow =</span> identity,</a>
<a class="sourceLine" id="cb145-4" data-line-number="4">                          <span class="dt">makeSlower =</span> <span class="cf">function</span>(x) { <span class="kw">Sys.sleep</span>(<span class="dv">5</span>); x })) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="st">"fastMethod"</span>, <span class="cf">function</span>() { <span class="kw">rnorm</span>(<span class="dv">5</span>) },</a>
<a class="sourceLine" id="cb145-6" data-line-number="6">              <span class="dt">post =</span> <span class="kw">list</span>(<span class="dt">keepFast =</span> identity,</a>
<a class="sourceLine" id="cb145-7" data-line-number="7">                          <span class="dt">makeSlower =</span> <span class="cf">function</span>(x) { <span class="kw">Sys.sleep</span>(<span class="dv">5</span>); x }))</a></code></pre></div>
<p>We run these methods in parallel using <code>parallel = TRUE</code> and specify a timeout limit of 1 second for the <code>BPPARAM</code>. Naturally, <code>slowMethod</code> will fail, and <code>fastMethod</code> will fail during the <code>makeSlower</code> post-processing function.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1">bpp &lt;-<span class="st"> </span><span class="kw">SerialParam</span>()</a>
<a class="sourceLine" id="cb146-2" data-line-number="2"><span class="kw">bptimeout</span>(bpp) &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb146-3" data-line-number="3"></a>
<a class="sourceLine" id="cb146-4" data-line-number="4">sbep &lt;-<span class="st"> </span><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(bdslow, <span class="dt">parallel =</span> <span class="ot">TRUE</span>, <span class="dt">BPPARAM =</span> bpp)</a></code></pre></div>
<pre><code>## !! error caught in buildBench !!
## !! error in main function of method: 'slowMethod'</code></pre>
<pre><code>## !!  original message: 
## !!  reached elapsed time limit</code></pre>
<pre><code>## !! error caught in buildBench !!
## !! error in method: 'fastMethod', post: 'makeSlower'</code></pre>
<pre><code>## !!  original message: 
## !!  reached elapsed time limit</code></pre>
<p>Notice that during the execution process, errors caught by <code><a href="../reference/buildBench.html">buildBench()</a></code> are printed to the console along with the name of the failed method and post-processing function when appropriate.</p>
<p>We can verify that a valid <em>SummarizedBenchmark</em> object is still returned with the the remaining results.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1">sbep</a></code></pre></div>
<pre><code>## class: SummarizedBenchmark 
## dim: 5 2 
## metadata(1): sessions
## assays(3): keepFast keepSlow makeSlower
## rownames: NULL
## rowData names(3): keepFast keepSlow makeSlower
## colnames(2): slowMethod fastMethod
## colData names(4): func.pkg func.pkg.vers func.pkg.manual
##   session.idx</code></pre>
<p>We can also check the values of the assays.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1"><span class="kw">sapply</span>(<span class="kw"><a href="../reference/SummarizedBenchmark-accessors.html">assayNames</a></span>(sbep), assay, <span class="dt">x =</span> sbep, <span class="dt">simplify =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## $keepFast
##      slowMethod  fastMethod
## [1,]         NA -0.86986039
## [2,]         NA  1.79291746
## [3,]         NA  1.41070110
## [4,]         NA -0.79853664
## [5,]         NA -0.01359238
## 
## $keepSlow
##      slowMethod fastMethod
## [1,]         NA         NA
## [2,]         NA         NA
## [3,]         NA         NA
## [4,]         NA         NA
## [5,]         NA         NA
## 
## $makeSlower
##      slowMethod fastMethod
## [1,]         NA         NA
## [2,]         NA         NA
## [3,]         NA         NA
## [4,]         NA         NA
## [5,]         NA         NA</code></pre>
<p>Notice that most columns contain only <code>NA</code> values. These columns correspond to both methods which returned errors, as well as methods missing post-processing functions, e.g. no <code>keepSlow</code> function was defined for the <code>fastMethod</code> method. While the <code>NA</code> values cannot be used to distinguish the sources of the <code>NA</code> values, this is documented in the <code>sessions</code> list of the <em>SummarizedBenchmark</em> metadata. While the <code>sessions</code> object is a list containing information for all previous sessions, we are only interested in the current, first session. (For more details on why multiple sessions may be run, see Section @ref(updating-analyses).)</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1"><span class="kw">names</span>(<span class="kw">metadata</span>(sbep)<span class="op">$</span>sessions[[<span class="dv">1</span>]])</a></code></pre></div>
<pre><code>## [1] "methods"     "results"     "parameters"  "sessionInfo"</code></pre>
<p>In <code>sessions</code>, there is a <code>"results"</code> entry which includes a summary of the results for each combination of method and post-processing function (assay). The entries of <code>results</code> can take one of three values: <code>"success"</code>, <code>"missing"</code>, or an error message of class <code>buildbench-error</code>. The easiest way to view these resultsis by passing the <code>results</code> to the base R function, <code>simplify2array()</code>.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1">sess1res &lt;-<span class="st"> </span><span class="kw">metadata</span>(sbep)<span class="op">$</span>sessions[[<span class="dv">1</span>]]<span class="op">$</span>results</a>
<a class="sourceLine" id="cb157-2" data-line-number="2"><span class="kw">simplify2array</span>(sess1res)</a></code></pre></div>
<pre><code>##            slowMethod                   fastMethod                  
## keepSlow   "reached elapsed time limit" "reached elapsed time limit"
## makeSlower "reached elapsed time limit" "missing"                   
## keepFast   "missing"                    "success"</code></pre>
<p>In the returned table, columns correspond to methods, and rows correspond to assays. We clearly see that many of the methods failed due to exceeding the specified time limit. If we check one of these entries more closesly, we see that it is indeed a <code>buildbench-error</code> object that occurred (<code>"origin"</code>) during the <code>"main"</code> function.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1">sess1res<span class="op">$</span>slowMethod<span class="op">$</span>keepSlow</a></code></pre></div>
<pre><code>## [1] "reached elapsed time limit"
## attr(,"class")
## [1] "buildbench-error"
## attr(,"origin")
## [1] "main"</code></pre>
<p>If this error handling is not wanted, and the user would like the benchmark experiment to terminate when an error is thrown, then the option <code>catchErrors = FALSE</code> can be specified to eiher <code><a href="../reference/buildBench.html">buildBench()</a></code> or <code><a href="../reference/updateBench.html">updateBench()</a></code>.</p>
</div>
<div id="specifying-method-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-method-metadata" class="anchor"></a>Specifying Method Metadata</h2>
<p>Metadata for methods are stored in the <code>colData()</code> of <em>SummarizedBenchmark</em> objects. As metioned above, several default metadata columns are populated in the <code>colData()</code> of the <em>SummarizedBenchmark</em> object generated by a call to <code><a href="../reference/buildBench.html">buildBench()</a></code>. Sometimes it may be useful to include additional metadata columns beyond just the default columns. While this can be accomplished manually by modifying the <code>colData()</code> of the <em>SummarizedBenchmark</em> object post hoc, method metadata can also be specified at the <code><a href="../reference/addMethod.html">addMethod()</a></code> step using the <code>meta =</code> optional parameter. The <code>meta =</code> parameter accepts a named list of metadata information. Each list entry will be added to the <code>colData()</code> as a new column. To avoid collisions between metadata columns specified with <code>meta =</code> and the default set of columns, metadata specified using <code>meta =</code> will be added to <code>colData()</code> with <code>meta.</code> prefixed to the column name.</p>
<p>As an example, we construct a <em>BenchDesign</em> object again using the differential expression example. The <em>BenchDesign</em> is created with two methods, <em><a href="http://bioconductor.org/packages/DESeq2">DESeq2</a></em> and <em><a href="http://bioconductor.org/packages/edgeR">edgeR</a></em>. Each method is specified with the optional <code>meta =</code> parameter. We can verify that the manually defined metadata column (<code>meta.reason</code>) is available in the <code>colData()</code> of the generated <em>SummarizedBenchmark</em>.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1">tempbd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> mydat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb161-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"deseq2"</span>,</a>
<a class="sourceLine" id="cb161-3" data-line-number="3">              <span class="dt">func =</span> deseq2_pvals,</a>
<a class="sourceLine" id="cb161-4" data-line-number="4">              <span class="dt">meta =</span> <span class="kw">list</span>(<span class="dt">reason =</span> <span class="st">"recommended by friend X"</span>),</a>
<a class="sourceLine" id="cb161-5" data-line-number="5">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb161-6" data-line-number="6">                                   <span class="dt">colData =</span> coldat, </a>
<a class="sourceLine" id="cb161-7" data-line-number="7">                                   <span class="dt">design =</span> <span class="op">~</span>condition,</a>
<a class="sourceLine" id="cb161-8" data-line-number="8">                                   <span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>))</a>
<a class="sourceLine" id="cb161-9" data-line-number="9">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb161-10" data-line-number="10"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"edgeR"</span>,</a>
<a class="sourceLine" id="cb161-11" data-line-number="11">              <span class="dt">func =</span> edgeR_pvals,</a>
<a class="sourceLine" id="cb161-12" data-line-number="12">              <span class="dt">meta =</span> <span class="kw">list</span>(<span class="dt">reason =</span> <span class="st">"recommended by friend Y"</span>), </a>
<a class="sourceLine" id="cb161-13" data-line-number="13">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb161-14" data-line-number="14">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb161-15" data-line-number="15">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)</a>
<a class="sourceLine" id="cb161-16" data-line-number="16">              )</a>
<a class="sourceLine" id="cb161-17" data-line-number="17"><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(tempbd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb161-18" data-line-number="18"><span class="st">    </span><span class="kw">colData</span>()</a></code></pre></div>
<pre><code>## DataFrame with 2 rows and 10 columns
##           func.pkg func.pkg.vers func.pkg.manual param.countData
##        &lt;character&gt;   &lt;character&gt;       &lt;logical&gt;     &lt;character&gt;
## deseq2          NA            NA           FALSE          cntdat
## edgeR           NA            NA           FALSE          cntdat
##        param.colData      param.design           param.contrast
##          &lt;character&gt;       &lt;character&gt;              &lt;character&gt;
## deseq2        coldat        ~condition c("condition", "2", "1")
## edgeR             NA ~coldat$condition                       NA
##                    meta.reason      param.group session.idx
##                    &lt;character&gt;      &lt;character&gt;   &lt;numeric&gt;
## deseq2 recommended by friend X               NA           1
## edgeR  recommended by friend Y coldat$condition           1</code></pre>
<p>While all methods in this example had the <code>meta =</code> option specified, this is not necessary. It is completely acceptable to specify the <code>meta =</code> parameter for only a subset of methods.</p>
</div>
<div id="specifying-version-metadata" class="section level2">
<h2 class="hasAnchor">
<a href="#specifying-version-metadata" class="anchor"></a>Specifying Version Metadata</h2>
<p>Arguably, two of the most important pieces of metadata stored in the <code>colData()</code> of the <em>SummarizedBenchmark</em> returned by <code><a href="../reference/buildBench.html">buildBench()</a></code> are the relevant package name and version (<code>pkg_name</code>, <code>pkg_vers</code>). Determining the package name and version requires the primary “workhorse” function of the method be directly specified as <code>func =</code> in the <code><a href="../reference/addMethod.html">addMethod()</a></code> call. In some cases, this may not be possible, e.g. if the “workhorse” function is a wrapper as in the differential expression example above. However, there still might exist an important function for which we would like to track the package name and version. The <code>meta</code> parameter can help.</p>
<p>The <code>meta =</code> parameter will handle the following named list entries as special values: <code>pkg_name</code>, <code>pkg_vers</code>, <code>pkg_func</code>. First, if values are specified for <code>pkg_name</code> and <code>pkg_vers</code> in <code>meta =</code>, these will overwrite the values determined from <code>func =</code>. To trace the source of <code>pkg_name</code> and <code>pkg_vers</code> information, the <code>vers_src</code> column of the <code>colData</code> will be set to <code>"meta_manual"</code> (the default value is <code>"func"</code>). Alternatively, a function can be passed to <code>meta =</code> as <code>pkg_func</code>. This function will be used to determine both <code>pkg_name</code> and <code>pkg_vers</code>, and will take precendence over manually specified <code>pkg_name</code> and <code>pkg_vers</code> values. If <code>pkg_func</code> is specified, it will be included in the <code>colData()</code> as a new column with the same name, and the <code>vers_src</code> column will be set to <code>"meta_func"</code>. **Note: the function should be wrapped in <code><a href="https://rlang.r-lib.org/reference/quotation.html">rlang::quo</a></code> to be properly parsed.</p>
<p>The following example illustrates the behavior when using either <code>pkg_func</code> or <code>pkg_name</code> and <code>pkg_vers</code> with the <code>meta</code> optional parameter.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1">tempbd &lt;-<span class="st"> </span><span class="kw"><a href="../reference/BenchDesign.html">BenchDesign</a></span>(<span class="dt">data =</span> mydat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb163-2" data-line-number="2"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"deseq2"</span>,</a>
<a class="sourceLine" id="cb163-3" data-line-number="3">              <span class="dt">func =</span> deseq2_pvals,</a>
<a class="sourceLine" id="cb163-4" data-line-number="4">              <span class="dt">meta =</span> <span class="kw">list</span>(<span class="dt">pkg_func =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quo</a></span>(DESeq2<span class="op">::</span>DESeq)),</a>
<a class="sourceLine" id="cb163-5" data-line-number="5">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb163-6" data-line-number="6">                                   <span class="dt">colData =</span> coldat, </a>
<a class="sourceLine" id="cb163-7" data-line-number="7">                                   <span class="dt">design =</span> <span class="op">~</span>condition,</a>
<a class="sourceLine" id="cb163-8" data-line-number="8">                                   <span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"1"</span>))</a>
<a class="sourceLine" id="cb163-9" data-line-number="9">              ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb163-10" data-line-number="10"><span class="st">    </span><span class="kw"><a href="../reference/addMethod.html">addMethod</a></span>(<span class="dt">label =</span> <span class="st">"edgeR"</span>,</a>
<a class="sourceLine" id="cb163-11" data-line-number="11">              <span class="dt">func =</span> edgeR_pvals,</a>
<a class="sourceLine" id="cb163-12" data-line-number="12">              <span class="dt">meta =</span> <span class="kw">list</span>(<span class="dt">pkg_name =</span> <span class="st">"edgeR"</span>,</a>
<a class="sourceLine" id="cb163-13" data-line-number="13">                          <span class="dt">pkg_vers =</span> <span class="kw">as.character</span>(<span class="kw">packageVersion</span>(<span class="st">"edgeR"</span>))), </a>
<a class="sourceLine" id="cb163-14" data-line-number="14">              <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">countData =</span> cntdat,</a>
<a class="sourceLine" id="cb163-15" data-line-number="15">                                   <span class="dt">group =</span> coldat<span class="op">$</span>condition,</a>
<a class="sourceLine" id="cb163-16" data-line-number="16">                                   <span class="dt">design =</span> <span class="op">~</span>coldat<span class="op">$</span>condition)</a>
<a class="sourceLine" id="cb163-17" data-line-number="17">              )</a>
<a class="sourceLine" id="cb163-18" data-line-number="18"><span class="kw"><a href="../reference/buildBench.html">buildBench</a></span>(tempbd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb163-19" data-line-number="19"><span class="st">    </span><span class="kw">colData</span>()</a></code></pre></div>
<pre><code>## DataFrame with 2 rows and 9 columns
##           func.pkg func.pkg.vers func.pkg.manual param.countData
##        &lt;character&gt;   &lt;character&gt;       &lt;logical&gt;     &lt;character&gt;
## deseq2      DESeq2        1.20.0            TRUE          cntdat
## edgeR        edgeR        3.22.1            TRUE          cntdat
##        param.colData      param.design           param.contrast
##          &lt;character&gt;       &lt;character&gt;              &lt;character&gt;
## deseq2        coldat        ~condition c("condition", "2", "1")
## edgeR             NA ~coldat$condition                       NA
##             param.group session.idx
##             &lt;character&gt;   &lt;numeric&gt;
## deseq2               NA           1
## edgeR  coldat$condition           1</code></pre>
</div>
<div id="modifying-methods-in-a-benchdesign" class="section level2">
<h2 class="hasAnchor">
<a href="#modifying-methods-in-a-benchdesign" class="anchor"></a>Modifying Methods in a BenchDesign</h2>
<p>Modifying the defintion of a method after it has been added to a <em>BenchDesign</em> is supported by the <code><a href="../reference/modifyMethod.html">modifyMethod()</a></code> function. The <em>BenchDesign</em> object created in the differential expression above includes a method called <em><a href="http://bioconductor.org/packages/DESeq2">DESeq2</a></em>. We can check the definition of this method using <code><a href="../reference/printMethod.html">printMethod()</a></code>.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1"><span class="kw"><a href="../reference/printMethod.html">printMethod</a></span>(bd, <span class="st">"deseq2"</span>)</a></code></pre></div>
<pre><code>## deseq2 ----------------------------------------------------- 
## BenchDesign Method (BDMethod) ------------------------------ 
##   method: deseq2_run
##     function (countData, colData, design, contrast) { ... 
##   parameters:
##     countData : cntdat 
##     colData : coldat 
##     design : ~condition 
##     contrast : c("condition", "2", "1") 
##   post:
##     pv : function (x) { ... 
##     lfc : function (x) { ... 
##   meta:
##     none</code></pre>
<p>Suppose we wish to both flip the order of the contrast, and add a metadata tag. This can be easily accomplished by passing both new parameters to <code><a href="../reference/modifyMethod.html">modifyMethod()</a></code> as a <code><a href="https://rlang.r-lib.org/reference/quotation.html">rlang::quos(..)</a></code> list, similar to how they would be passed to <code><a href="../reference/addMethod.html">addMethod()</a></code>. If the <code>func</code>, <code>post</code>, or <code>meta</code> valuesshould be modified, they should be included in the list using the special keywords, <code>bd.func =</code>, <code>bd.post =</code>, or <code>bd.meta =</code>, as shown in the example below.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1"><span class="kw"><a href="../reference/modifyMethod.html">modifyMethod</a></span>(bd, <span class="dt">label =</span> <span class="st">"deseq2"</span>, </a>
<a class="sourceLine" id="cb167-2" data-line-number="2">             <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>),</a>
<a class="sourceLine" id="cb167-3" data-line-number="3">                                  <span class="dt">bd.meta =</span> <span class="kw">list</span>(<span class="dt">note =</span> <span class="st">"modified post hoc"</span>))</a>
<a class="sourceLine" id="cb167-4" data-line-number="4">             ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="../reference/printMethod.html">printMethod</a></span>(<span class="st">"deseq2"</span>)</a></code></pre></div>
<pre><code>## deseq2 ----------------------------------------------------- 
## BenchDesign Method (BDMethod) ------------------------------ 
##   method: deseq2_run
##     function (countData, colData, design, contrast) { ... 
##   parameters:
##     countData : cntdat 
##     colData : coldat 
##     design : ~condition 
##     contrast : c("condition", "1", "2") 
##   post:
##     pv : function (x) { ... 
##     lfc : function (x) { ... 
##   meta:
##     note : "modified post hoc"</code></pre>
<p>Sometimes it may be desirable to completely overwrite all function parameters for a method, e.g. <code>countData</code>, <code>colData</code>, <code>design</code>, and <code>contrast</code> in the case of <em><a href="http://bioconductor.org/packages/DESeq2">DESeq2</a></em>. This may occur if some parameters were optional and originally specified, but no longer necessary. All function parameters can be overwritten by specifying <code>.overwrite = TRUE</code>.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" data-line-number="1"><span class="kw"><a href="../reference/modifyMethod.html">modifyMethod</a></span>(bd, <span class="dt">label =</span> <span class="st">"deseq2"</span>, </a>
<a class="sourceLine" id="cb169-2" data-line-number="2">             <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>),</a>
<a class="sourceLine" id="cb169-3" data-line-number="3">                                  <span class="dt">bd.meta =</span> <span class="kw">list</span>(<span class="dt">note =</span> <span class="st">"modified post hoc"</span>)),</a>
<a class="sourceLine" id="cb169-4" data-line-number="4">             <span class="dt">.overwrite =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb169-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="../reference/printMethod.html">printMethod</a></span>(<span class="st">"deseq2"</span>)</a></code></pre></div>
<pre><code>## deseq2 ----------------------------------------------------- 
## BenchDesign Method (BDMethod) ------------------------------ 
##   method: deseq2_run
##     function (countData, colData, design, contrast) { ... 
##   parameters:
##     contrast : c("condition", "1", "2") 
##   post:
##     pv : function (x) { ... 
##     lfc : function (x) { ... 
##   meta:
##     note : "modified post hoc"</code></pre>
<p>Notice that all parameters other than <code>contrast = c("condition", "1", "2")</code> have been dropped.</p>
</div>
<div id="duplicating-methods-in-a-benchdesign" class="section level2">
<h2 class="hasAnchor">
<a href="#duplicating-methods-in-a-benchdesign" class="anchor"></a>Duplicating Methods in a BenchDesign</h2>
<p>In addition to comparing multiple methods, a benchmark study may also involve comparing a single method across several parameter settings. The <code><a href="../reference/expandMethod.html">expandMethod()</a></code> function provides the capability to take a method already defined in the <em>BenchDesign</em>, and <em>expand</em> it to multiple methods with differing parameter values in the <em>BenchDesign</em> object. In the following example, <code><a href="../reference/expandMethod.html">expandMethod()</a></code> is used to duplicate the <em><a href="http://bioconductor.org/packages/DESeq2">DESeq2</a></em> method with only the <code>"contrast"</code> parameter modified.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1">bde &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expandMethod.html">expandMethod</a></span>(bd, <span class="dt">label =</span> <span class="st">"deseq2"</span>, </a>
<a class="sourceLine" id="cb171-2" data-line-number="2">                    <span class="dt">onlyone =</span> <span class="st">"contrast"</span>,</a>
<a class="sourceLine" id="cb171-3" data-line-number="3">                    <span class="dt">params =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">deseq2_v1 =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>),</a>
<a class="sourceLine" id="cb171-4" data-line-number="4">                                         <span class="dt">deseq2_v2 =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>))</a>
<a class="sourceLine" id="cb171-5" data-line-number="5">                    )</a>
<a class="sourceLine" id="cb171-6" data-line-number="6"><span class="kw"><a href="../reference/printMethod.html">printMethod</a></span>(bde, <span class="st">"deseq2_v1"</span>)</a></code></pre></div>
<pre><code>## deseq2_v1 -------------------------------------------------- 
## BenchDesign Method (BDMethod) ------------------------------ 
##   method: deseq2_run
##     function (countData, colData, design, contrast) { ... 
##   parameters:
##     countData : cntdat 
##     colData : coldat 
##     design : ~condition 
##     contrast : c("condition", "1", "2") 
##   post:
##     pv : function (x) { ... 
##     lfc : function (x) { ... 
##   meta:
##     none</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1"><span class="kw"><a href="../reference/printMethod.html">printMethod</a></span>(bde, <span class="st">"deseq2_v2"</span>)</a></code></pre></div>
<pre><code>## deseq2_v2 -------------------------------------------------- 
## BenchDesign Method (BDMethod) ------------------------------ 
##   method: deseq2_run
##     function (countData, colData, design, contrast) { ... 
##   parameters:
##     countData : cntdat 
##     colData : coldat 
##     design : ~condition 
##     contrast : c("condition", "2", "2") 
##   post:
##     pv : function (x) { ... 
##     lfc : function (x) { ... 
##   meta:
##     none</code></pre>
<p>Notice that the parameter to be modified is specified with <code>onlyone =</code> (denoting “only one” parameter will be changed), and that method names are taken from names of the quosure list passed to <code>params =</code> in the <code><a href="../reference/expandMethod.html">expandMethod()</a></code> call. To modify more than a single parameter in the duplicated methods, the <code>onlyone =</code> parameter can be ignored, and the new parameter values specified to <code>params =</code> as a list of quosure lists. Below, both the <code>"contrast"</code> and <code>meta</code> parameters are modified in the expanded methods.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1">bde &lt;-<span class="st"> </span><span class="kw"><a href="../reference/expandMethod.html">expandMethod</a></span>(bd, <span class="dt">label =</span> <span class="st">"deseq2"</span>, </a>
<a class="sourceLine" id="cb175-2" data-line-number="2">                    <span class="dt">params =</span> <span class="kw">list</span>(<span class="dt">deseq2_v1 =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"1"</span>, <span class="st">"2"</span>),</a>
<a class="sourceLine" id="cb175-3" data-line-number="3">                                                          <span class="dt">meta =</span> <span class="kw">list</span>(<span class="dt">note =</span> <span class="st">"filp order"</span>)),</a>
<a class="sourceLine" id="cb175-4" data-line-number="4">                                  <span class="dt">deseq2_v2 =</span> rlang<span class="op">::</span><span class="kw"><a href="https://rlang.r-lib.org/reference/quotation.html">quos</a></span>(<span class="dt">contrast =</span> <span class="kw">c</span>(<span class="st">"condition"</span>, <span class="st">"2"</span>, <span class="st">"2"</span>),</a>
<a class="sourceLine" id="cb175-5" data-line-number="5">                                                          <span class="dt">meta =</span> <span class="kw">list</span>(<span class="dt">note =</span> <span class="st">"nonsensical order"</span>))</a>
<a class="sourceLine" id="cb175-6" data-line-number="6">                                  )</a>
<a class="sourceLine" id="cb175-7" data-line-number="7">                    )</a>
<a class="sourceLine" id="cb175-8" data-line-number="8"><span class="kw"><a href="../reference/printMethod.html">printMethod</a></span>(bde, <span class="st">"deseq2_v1"</span>)</a></code></pre></div>
<pre><code>## deseq2_v1 -------------------------------------------------- 
## BenchDesign Method (BDMethod) ------------------------------ 
##   method: deseq2_run
##     function (countData, colData, design, contrast) { ... 
##   parameters:
##     countData : cntdat 
##     colData : coldat 
##     design : ~condition 
##     contrast : c("condition", "1", "2") 
##     meta : list(note = "filp order") 
##   post:
##     pv : function (x) { ... 
##     lfc : function (x) { ... 
##   meta:
##     none</code></pre>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1"><span class="kw"><a href="../reference/printMethod.html">printMethod</a></span>(bde, <span class="st">"deseq2_v2"</span>)</a></code></pre></div>
<pre><code>## deseq2_v2 -------------------------------------------------- 
## BenchDesign Method (BDMethod) ------------------------------ 
##   method: deseq2_run
##     function (countData, colData, design, contrast) { ... 
##   parameters:
##     countData : cntdat 
##     colData : coldat 
##     design : ~condition 
##     contrast : c("condition", "2", "2") 
##     meta : list(note = "nonsensical order") 
##   post:
##     pv : function (x) { ... 
##     lfc : function (x) { ... 
##   meta:
##     none</code></pre>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-Benjamini_1995">
<p>Benjamini, Yoav, and Yosef Hochberg. 1995. “Controlling the False Discovery Rate: A Practical and Powerful Approach to Multiple Testing.” <em>Journal of the Royal Statistical Society. Series B (Methodological)</em>, 289–300.</p>
</div>
<div id="ref-Dunn_1961">
<p>Dunn, Olive Jean. 1961. “Multiple Comparisons Among Means.” <em>Journal of the American Statistical Association</em> 56 (293):52–64.</p>
</div>
<div id="ref-Soneson_2016">
<p>Soneson, Charlotte, and Mark D Robinson. 2016. “iCOBRA: Open, Reproducible, Standardized and Live Method Benchmarking.” <em>Nature Methods</em> 13 (4):283–83. <a href="https://doi.org/10.1038/nmeth.3805" class="uri">https://doi.org/10.1038/nmeth.3805</a>.</p>
</div>
<div id="ref-Stephens_2017">
<p>Stephens, Matthew. 2017. “False discovery rates: a new deal.” <em>Biostatistics</em> 18 (2):275–94. <a href="https://doi.org/10.1093/biostatistics/kxw041" class="uri">https://doi.org/10.1093/biostatistics/kxw041</a>.</p>
</div>
<div id="ref-Storey_2002">
<p>Storey, John D. 2002. “A Direct Approach to False Discovery Rates.” <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 64 (3):479–98.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction">Introduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#related-work">Related Work</a></li>
      </ul>
</li>
      <li><a href="#quickstart-case-study">Quickstart Case Study</a></li>
      <li>
<a href="#class-details">Class Details</a><ul class="nav nav-pills nav-stacked">
<li><a href="#benchdesign">BenchDesign</a></li>
      <li><a href="#summarizedbenchmark">SummarizedBenchmark</a></li>
      <li><a href="#reproducibility-and-replicability">Reproducibility and Replicability</a></li>
      </ul>
</li>
      <li>
<a href="#differential-expression-case-study">Differential Expression Case Study</a><ul class="nav nav-pills nav-stacked">
<li><a href="#benchmark-set-up-and-execution">Benchmark Set-Up and Execution</a></li>
      <li><a href="#benchmark-evaluation">Benchmark Evaluation</a></li>
      </ul>
</li>
      <li>
<a href="#additional-features">Additional Features</a><ul class="nav nav-pills nav-stacked">
<li><a href="#reusing-a-benchdesign-across-data-sets">Reusing a BenchDesign Across Data Sets</a></li>
      <li><a href="#storing-multiple-outputs">Storing Multiple Outputs</a></li>
      <li><a href="#parallelizing-with-biocparallel">Parallelizing with BiocParallel</a></li>
      <li><a href="#updating-analyses">Updating Analyses</a></li>
      <li><a href="#error-handling">Error Handling</a></li>
      <li><a href="#specifying-method-metadata">Specifying Method Metadata</a></li>
      <li><a href="#specifying-version-metadata">Specifying Version Metadata</a></li>
      <li><a href="#modifying-methods-in-a-benchdesign">Modifying Methods in a BenchDesign</a></li>
      <li><a href="#duplicating-methods-in-a-benchdesign">Duplicating Methods in a BenchDesign</a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://alejandroreyes.org">Alejandro Reyes</a>, <a href="https://www.pkimes.com">Patrick Kimes</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
